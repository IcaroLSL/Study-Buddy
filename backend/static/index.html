<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyBuddy - Seu Acompanhante de Estudos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="data:,">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .active-tab {
            border-bottom: 3px solid #0ea5e9;
            color: #0ea5e9;
        }

        .note-card {
            transition: all 0.2s ease;
        }

        .note-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .note-actions-menu {
            display: none;
            position: absolute;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 50;
            min-width: 120px;
        }

        .dark .note-actions-menu {
            background: #374151;
        }

        .note-actions-menu.show {
            display: block;
        }

        .calendar-day {
            width: 100%;
            padding: 0.25rem 0;
            box-sizing: border-box;
            font-size: 0.875rem;
        }

        .reminder-overdue {
            border-left: 4px solid #ef4444;
            background-color: rgba(239, 68, 68, 0.05);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .dark .reminder-overdue {
            background-color: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
        }

        .calendar-day:hover {
            background-color: rgba(14, 165, 233, 0.2);
        }

        .calendar-day.today {
            background-color: rgba(14, 165, 233, 0.1);
            border-radius: 50%;
            font-weight: bold;
            color: #0ea5e9;
        }

        .calendar-day.has-event::after {
            content: '';
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background-color: #0ea5e9;
            border-radius: 50%;
        }

        .reminder-item {
            transition: all 0.2s ease;
        }

        .reminder-item:hover {
            transform: translateY(-2px);
        }

        .summary-card {
            transition: all 0.2s ease;
        }

        .summary-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .event-item {
            transition: all 0.2s ease;
        }

        .event-item:hover {
            background-color: rgba(0, 0, 0, 0.02);
            border-radius: 8px;
        }

        .dark .event-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .edit-reminder-btn {
            transition: all 0.2s ease;
        }

        .edit-reminder-btn:hover {
            transform: scale(1.1);
        }

        #custom-minutes {
            appearance: textfield;
        }

        #custom-minutes::-webkit-outer-spin-button,
        #custom-minutes::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Garantir que o grid de dias tenha 7 colunas */
        #calendar-days,
        .calendar-weekdays {
            padding-left: 0;
            padding-right: 0;
            margin: 0;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            padding: 0.25rem;
            font-size: 0.875rem;
        }

        .calendar-day.opacity-0 {
            opacity: 0;
            pointer-events: none;
        }

        .action-btn {
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        .reminder-item {
            transition: background-color 0.3s ease;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }
        }

        .action-btn i {
            transition: transform 0.3s ease, color 0.2s ease;
        }

        .action-btn:hover i {
            animation: bounce 0.5s;
        }

        #notifications-panel {
            z-index: 100;
            /* Garante que fique acima de tudo */
            will-change: transform;
            /* Otimização de performance */
        }

        /* Impede que cliques no painel fechem a tela */
        #notifications-panel * {
            pointer-events: auto;
        }

        .folder-card {
            transition: all 0.2s ease;
        }

        .folder-card:hover {
            transform: translateY(-2px);
        }

        .material-card {
            transition: all 0.2s ease;
        }

        .material-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .dark .material-card:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.25);
        }

        #timer-sound:checked~.toggle-dot {
            transform: translateX(100%);
            background-color: #0ea5e9;
            /* Cor primária do seu tema */
        }

        /* Estilos para o player do Spotify */
        #spotify-container {
            transition: all 0.3s ease;
        }

        #spotify-container iframe {
            border: none;
        }

        #close-spotify {
            display: none;
            font-size: 16px;
            font-weight: bold;
        }

        #spotify-container:hover #close-spotify {
            display: block;
        }

        /* Dark mode support */
        .dark #spotify-container {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        /* Garanta que nenhuma seção esteja com display: block por padrão */
        /* main > section {
            display: none;
        }

        main > section.fade-in {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        } */
        .play-btn.playing {
            background-color: #0ea5e9;
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .play-btn.paused {
            background-color: transparent;
            color: #0ea5e9;
        }

        .play-btn:hover {
            transform: scale(1.1);
            transition: all 0.2s ease;
        }

        #custom-music-player {
            transition: all 0.3s ease;
            border: 1px solid rgba(14, 165, 233, 0.2);
        }

        .dark #custom-music-player {
            border-color: rgba(14, 165, 233, 0.4);
        }

        #custom-music-player button {
            padding: 8px 12px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        #custom-music-player button:hover {
            background-color: rgba(14, 165, 233, 0.1);
        }

        #close-music-player {
            padding: 4px;
            border-radius: 50%;
        }

        #close-music-player:hover {
            background-color: rgba(239, 68, 68, 0.1);
        }
    </style>
</head>

<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">
    <div class="max-w-md mx-auto pb-20">
        <header class="bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-10">
            <div class="px-4 py-3 flex justify-between items-center">
                <div id="home-btn" class="flex items-center space-x-2 cursor-pointer">
                    <i class="fas fa-graduation-cap text-2xl text-primary-600"></i>
                    <h1 class="text-xl font-bold">StudyBuddy</h1>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="notifications-btn"
                        class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 relative"
                        onclick="event.stopPropagation()">
                        <i class="fas fa-bell"></i>
                        <span id="notification-badge"
                            class="absolute top-0 right-0 bg-red-500 text-white text-xs w-4 h-4 rounded-full flex items-center justify-center">3</span>
                    </button>
                    <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                        <i class="fas fa-moon dark:hidden"></i>
                        <i class="fas fa-adjust hidden dark:block"></i>
                    </button>
                </div>
            </div>
        </header>

        <main class="px-4 py-4">
            <section id="dashboard" class="mb-8 fade-in">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">Meu Dashboard</h2>
                </div>

                <div class="grid grid-cols-2 gap-3 mb-6">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Tempo Estudado</p>
                                <p id="study-time" class="text-xl font-bold">0h 0m</p>

                            </div>
                            <div class="p-2 rounded-full bg-primary-100 dark:bg-primary-900">
                                <i class="fas fa-clock text-primary-600"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Tarefas</p>
                                <p id="task-counter" class="text-xl font-bold">0/0</p>
                            </div>
                            <div class="p-2 rounded-full bg-green-100 dark:bg-green-900">
                                <i class="fas fa-check-circle text-green-600"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow mb-6">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-medium">Seu Desempenho</h3>
                        <select id="study-range" class="text-sm bg-gray-100 dark:bg-gray-700 rounded px-2 py-1">
                            <option>Esta Semana</option>
                            <option>Este Mês</option>
                            <option>Este Ano</option>
                        </select>
                    </div>
                    <div id="study-chart-wrapper" class="overflow-x-auto bg-gray-100 dark:bg-gray-700 rounded">
                        <div id="study-chart"
                            class="h-40 flex items-end gap-2 px-4 transition-all duration-300 ease-in-out">
                            <!-- barras injetadas via JS -->
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-4 gap-2 mb-6">
                    <button id="calendar-btn"
                        class="flex flex-col items-center p-3 bg-white dark:bg-gray-800 rounded-lg shadow">
                        <div class="p-2 rounded-full bg-purple-100 dark:bg-purple-900 mb-1">
                            <i class="fas fa-calendar-alt text-purple-600"></i>
                        </div>
                        <span class="text-xs">Calendário</span>
                    </button>
                    <button id="summaries-btn"
                        class="flex flex-col items-center p-3 bg-white dark:bg-gray-800 rounded-lg shadow">
                        <div class="p-2 rounded-full bg-blue-100 dark:bg-blue-900 mb-1">
                            <i class="fas fa-book text-blue-600"></i>
                        </div>
                        <span class="text-xs">Resumos</span>
                    </button>
                    <button id="reminders-btn"
                        class="flex flex-col items-center p-3 bg-white dark:bg-gray-800 rounded-lg shadow">
                        <div class="p-2 rounded-full bg-yellow-100 dark:bg-yellow-900 mb-1">
                            <i class="fas fa-bell text-yellow-600"></i>
                        </div>
                        <span class="text-xs">Tarefas</span>
                    </button>
                    <button id="materials-btn"
                        class="flex flex-col items-center p-3 bg-white dark:bg-gray-800 rounded-lg shadow">
                        <div class="p-2 rounded-full bg-indigo-100 dark:bg-indigo-900 mb-1">
                            <i class="fas fa-book-open text-indigo-600"></i>
                        </div>
                        <span class="text-xs">Materiais</span>
                    </button>
                </div>
            </section>

            <section id="techniques" class="mb-8 fade-in hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">Técnicas de Estudo</h2>
                    <button class="text-primary-600 text-sm font-medium">Ver todas</button>
                </div>

                <div class="space-y-3">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow">
                        <div class="flex items-start">
                            <div class="p-2 rounded-full bg-red-100 dark:bg-red-900 mr-3">
                                <i class="fas fa-stopwatch text-red-600"></i>
                            </div>
                            <div>
                                <h3 class="font-medium">Pomodoro</h3>
                                <p class="text-sm text-gray-500">Tempo de estudo + Tempo de descanso</p>
                                <button class="mt-2 text-primary-600 text-sm font-medium technique-btn"
                                    data-technique="pomodoro">Iniciar</button>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow">
                        <div class="flex items-start">
                            <div class="p-2 rounded-full bg-indigo-100 dark:bg-indigo-900 mr-3">
                                <i class="fas fa-layer-group text-indigo-600"></i>
                            </div>
                            <div>
                                <h3 class="font-medium">Feynman</h3>
                                <p class="text-sm text-gray-500">Ensine o conteúdo para reforçar aprendizado</p>
                                <button class="mt-2 text-primary-600 text-sm font-medium technique-btn"
                                    data-technique="feynman">Experimentar</button>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow">
                        <div class="flex items-start">
                            <div class="p-2 rounded-full bg-green-100 dark:bg-green-900 mr-3">
                                <i class="fas fa-brain text-green-600"></i>
                            </div>
                            <div>
                                <h3 class="font-medium">Mapa Mental</h3>
                                <p class="text-sm text-gray-500">Organize ideias visualmente</p>
                                <button class="mt-2 text-primary-600 text-sm font-medium technique-btn"
                                    data-technique="mindmap">Criar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="notes" class="mb-8 fade-in hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">Minhas Anotações</h2>
                    <button id="add-note-btn" class="text-primary-600 text-sm font-medium">+ Nova</button>
                </div>

                <div id="notes-container" class="grid grid-cols-2 gap-3">
                </div>
            </section>

            <section id="community" class="mb-8 fade-in hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">Comunidade</h2>
                    <button class="text-primary-600 text-sm font-medium">Ver todos</button>
                </div>

                <div class="space-y-3">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow">
                        <div class="flex items-start mb-3">
                            <img src="https://randomuser.me/api/portraits/women/44.jpg"
                                class="w-10 h-10 rounded-full mr-3">
                            <div>
                                <h3 class="font-medium">Ana Silva</h3>
                                <p class="text-xs text-gray-500">Estudante de Medicina</p>
                            </div>
                        </div>
                        <p class="text-sm mb-3">Alguém pode me ajudar com bioquímica? Estou com dúvidas sobre o ciclo de
                            Krebs.</p>
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>2 horas atrás</span>
                            <div class="flex space-x-3">
                                <span><i class="far fa-comment mr-1"></i> 5</span>
                                <span><i class="far fa-heart mr-1"></i> 12</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow">
                        <div class="flex items-start mb-3">
                            <img src="https://randomuser.me/api/portraits/men/32.jpg"
                                class="w-10 h-10 rounded-full mr-3">
                            <div>
                                <h3 class="font-medium">Carlos Oliveira</h3>
                                <p class="text-xs text-gray-500">Estudante de Engenharia</p>
                            </div>
                        </div>
                        <p class="text-sm mb-3">Compartilhando meu resumo sobre cálculo diferencial e integral. Espero
                            que ajude!</p>
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>5 horas atrás</span>
                            <div class="flex space-x-3">
                                <span><i class="far fa-comment mr-1"></i> 3</span>
                                <span><i class="far fa-heart mr-1"></i> 24</span>
                            </div>
                        </div>
                    </div>

                    <button
                        class="w-full py-2 border border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 transition">
                        <i class="fas fa-plus mr-1"></i> Nova publicação
                    </button>
                </div>
            </section>

            <section id="focus" class="mb-8 fade-in hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">Modo Foco</h2>
                    <button class="text-primary-600 text-sm font-medium">Histórico</button>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow text-center">
                    <!-- Timer Display -->
                    <div
                        class="w-40 h-40 mx-auto mb-6 rounded-full border-4 border-primary-500 flex items-center justify-center">
                        <span id="timer-display" class="text-3xl font-bold">25:00</span>
                    </div>

                    <!-- Preset Buttons -->
                    <div class="grid grid-cols-3 gap-2 mb-6">
                        <button
                            class="timer-duration-btn py-2 bg-primary-100 dark:bg-primary-900 text-primary-600 dark:text-primary-300 rounded"
                            data-duration="25">25 min</button>
                        <button class="timer-duration-btn py-2 bg-gray-100 dark:bg-gray-700 rounded"
                            data-duration="50">50 min</button>
                        <button class="timer-duration-btn py-2 bg-gray-100 dark:bg-gray-700 rounded"
                            data-duration="90">90 min</button>
                    </div>

                    <!-- Custom Time Input -->
                    <div class="mb-6 flex items-center justify-center space-x-2">
                        <input type="number" id="custom-minutes" min="1" max="240"
                            class="w-16 py-2 px-3 border border-gray-200 dark:border-gray-700 rounded-lg text-center dark:bg-gray-900"
                            placeholder="0">
                        <span>minutos</span>
                        <button id="set-custom-time"
                            class="py-2 px-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700">
                            Definir
                        </button>
                    </div>

                    <!-- Control Buttons -->
                    <div class="flex gap-2 mb-6">
                        <button id="timer-start-btn"
                            class="flex-1 py-3 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 transition">
                            Iniciar Sessão
                        </button>
                        <button id="timer-reset-btn"
                            class="px-4 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-medium hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                            Reset
                        </button>
                    </div>

                    <!-- Settings -->
                    <div class="mt-6">
                        <h3 class="font-medium mb-2">Configurações do Timer</h3>
                        <div class="flex justify-between items-center mb-2">
                            <span>Notificações</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="timer-notifications" class="sr-only peer" checked>
                                <div
                                    class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary-600">
                                </div>
                            </label>
                        </div>
                        <div class="flex justify-between items-center">
                            <span>Música de fundo</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="timer-sound" class="sr-only peer">
                                <div
                                    class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary-600">
                                </div>
                            </label>
                        </div>
                        <p class="text-sm text-gray-500">Para alterar a playlist acesse a aba de configurações.</p>
                        <div class="mt-4 bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                            <p class="text-sm mb-2">Para música de fundo no Spotify:</p>
                            <a href="https://open.spotify.com/playlist/1QcsybeUidDJIrPQTHS6dD" target="_blank"
                                class="inline-flex items-center bg-green-600 text-white px-4 py-2 rounded-lg">
                                <i class="fab fa-spotify mr-2"></i>
                                Abrir
                            </a>
                        </div>
                        <!-- Div onde a API do YouTube irá montar o player (invisível) -->
                        <div id="youtube-player"></div>
                    </div>
                    <!-- <div id="custom-music-player"
                        class="fixed bottom-24 left-1/2 transform -translate-x-1/2 w-[300px] p-4 bg-white dark:bg-gray-800 shadow-lg rounded-lg hidden z-40">
                        <div class="flex items-center justify-between mb-2">
                            <span id="current-song-title" class="text-sm font-medium truncate w-52">Nenhuma
                                música</span>
                            <button id="close-music-player" class="text-gray-500 hover:text-red-500">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="flex justify-between items-center">
                            <button id="prev-song" class="text-primary-600"><i class="fas fa-backward"></i></button>
                            <button id="toggle-play" class="text-primary-600 text-xl"><i
                                    class="fas fa-play"></i></button>
                            <button id="next-song" class="text-primary-600"><i class="fas fa-forward"></i></button>
                        </div>
                        <div class="mt-2 text-xs text-gray-500 text-center" id="song-time">00:00</div>
                    </div> -->
                    <div id="custom-music-player"
                        class="mt-6 w-full p-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg">
                        <div class="flex items-center justify-between mb-2">
                            <span id="current-song-title" class="text-sm font-medium truncate">Nenhuma música</span>
                            <button id="close-music-player" class="text-gray-500 hover:text-red-500">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="flex justify-between items-center">
                            <button id="prev-song" class="text-primary-600"><i class="fas fa-backward"></i></button>
                            <button id="toggle-play" class="text-primary-600 text-xl"><i
                                    class="fas fa-play"></i></button>
                            <button id="next-song" class="text-primary-600"><i class="fas fa-forward"></i></button>
                        </div>
                        <div class="mt-2 text-xs text-gray-500 text-center" id="song-time">00:00</div>
                    </div>
                </div>
            </section>

            <section id="calendar" class="mb-8 fade-in hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">Calendário</h2>
                    <button id="add-event-btn" class="text-primary-600 text-sm font-medium">+ Novo Evento</button>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow mb-4 w-full">
                    <div class="flex justify-between items-center mb-4">
                        <button id="prev-month" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h3 id="calendar-month-year" class="font-medium">Junho 2025</h3>
                        <button id="next-month" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>

                    <div class="grid grid-cols-7 gap-0 text-center text-xs text-gray-500 mb-2 w-full">
                        <div>Dom</div>
                        <div>Seg</div>
                        <div>Ter</div>
                        <div>Qua</div>
                        <div>Qui</div>
                        <div>Sex</div>
                        <div>Sáb</div>
                    </div>

                    <div id="calendar-days" class="grid grid-cols-7 gap-0 text-center w-full">
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow">
                    <h3 class="font-medium mb-3">Próximos Eventos</h3>
                    <div id="upcoming-events" class="space-y-3">
                    </div>
                </div>
            </section>

            <section id="summaries" class="mb-8 fade-in hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">Meus Resumos</h2>
                    <button id="add-summary-btn" class="text-primary-600 text-sm font-medium">+ Novo</button>
                </div>

                <div class="space-y-3" id="summaries-container">
                </div>
            </section>

            <section id="reminders" class="mb-8 fade-in hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">Lembretes</h2>
                    <button id="add-reminder-btn" class="text-primary-600 text-sm font-medium">+ Novo</button>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow mb-4">
                    <h3 class="font-medium mb-3 text-red-500">Atrasados</h3>
                    <div id="overdue-reminders" class="space-y-2">
                        <!-- preenchido via JS -->
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow mb-4">
                    <h3 class="font-medium mb-3">Hoje</h3>
                    <div id="today-reminders" class="space-y-2">
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow">
                    <h3 class="font-medium mb-3">Próximos</h3>
                    <div id="upcoming-reminders" class="space-y-2">
                    </div>
                </div>

                <!-- Adicione esta seção após a div de "Próximos" -->
                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow mt-4">
                    <h3 class="font-medium mb-3 text-gray-500">Concluídos</h3>
                    <div id="completed-reminders" class="space-y-2">
                        <!-- preenchido via JS -->
                    </div>
                </div>
            </section>
            <section id="materials" class="mb-8 fade-in hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">Materiais de Estudo</h2>
                    <button id="add-material-btn" class="text-primary-600 text-sm font-medium">+ Adicionar</button>
                </div>

                <!-- Breadcrumb Navigation -->
                <div id="materials-breadcrumb" class="flex items-center space-x-2 mb-4 text-sm text-gray-500 dark:text-gray-400">
                    <span class="breadcrumb-item cursor-pointer hover:text-primary-600" data-id="root">
                        <i class="fas fa-home"></i> Raiz
                    </span>
                </div>

                <!-- Seção de Pastas -->
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-medium">Pastas</h3>
                        <button id="add-folder-btn" class="text-primary-600 text-xs font-medium">+ Nova Pasta</button>
                    </div>
                    <div id="folders-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2">
                        <!-- Pastas serão injetadas via JS -->
                    </div>
                    <div id="no-folders" class="hidden text-center text-gray-500 dark:text-gray-400 py-4 text-sm">
                        Nenhuma pasta nesta localização
                    </div>
                </div>

                <!-- Divisor -->
                <div class="border-t border-dashed border-gray-300 dark:border-gray-600 my-4"></div>

                <!-- Seção de Materiais -->
                <div>
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-medium">Materiais</h3>
                        <div class="flex space-x-2">
                            <select id="material-filter" class="text-xs bg-gray-100 dark:bg-gray-700 rounded px-2 py-1">
                                <option value="Todos">Todos</option>
                                <option value="PDF">PDF</option>
                                <option value="Vídeo">Vídeo</option>
                                <option value="Link">Link</option>
                                <option value="Documento">Documento</option>
                                <option value="Imagem">Imagem</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3" id="materials-container">
                        <!-- Materiais serão injetados via JS -->
                    </div>

                    <!-- Estado vazio -->
                    <div id="no-materials"
                        class="hidden bg-white dark:bg-gray-800 rounded-lg p-6 text-center border border-dashed border-gray-300 dark:border-gray-600 mt-4">
                        <p class="text-gray-500 dark:text-gray-400 mb-3">Nenhum material nesta pasta</p>
                        <button id="add-first-material-btn" class="text-primary-600 text-sm font-medium hover:underline">Adicionar primeiro material</button>
                    </div>
                </div>
            </section>
            <section id="config" class="mb-8 fade-in hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">Configurações</h2>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow mb-6">
                    <h3 class="font-medium mb-4">Conta</h3>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-white">Nome de Usuário</label>
                            <input type="text" id="username"
                                class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400"
                                placeholder="Digite seu nome de usuário">
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-white">Email</label>
                            <input type="email" id="email"
                                class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400"
                                placeholder="Digite seu email">
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-white">Alterar Senha</label>
                            <input type="password" id="new-password"
                                class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400 mb-2"
                                placeholder="Nova senha">
                            <input type="password" id="confirm-password"
                                class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400"
                                placeholder="Confirmar nova senha">
                        </div>

                        <button id="save-account-btn"
                            class="w-full py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition">
                            Salvar Alterações
                        </button>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow mb-6">
                    <h3 class="font-medium mb-4">Preferências</h3>

                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <label class="block text-sm font-medium mb-1 dark:text-white">Tema Escuro</label>
                                <p class="text-xs text-gray-500">Ative ou desative o modo escuro</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="dark-mode-toggle" class="sr-only peer" checked>
                                <div
                                    class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary-600">
                                </div>
                            </label>
                        </div>

                        <div class="flex justify-between items-center">
                            <div>
                                <label class="block text-sm font-medium mb-1 dark:text-white">Notificações</label>
                                <p class="text-xs text-gray-500">Ative para receber lembretes</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="notifications-toggle" class="sr-only peer" checked>
                                <div
                                    class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary-600">
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow">
                    <h3 class="font-medium mb-4">Música de Fundo</h3>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-white">Playlist do Spotify</label>
                            <input type="text" id="spotify-playlist"
                                class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400"
                                placeholder="Cole o link da playlist">
                            <p class="text-xs text-gray-500 mt-1">Exemplo:
                                https://open.spotify.com/playlist/37i9dQZF1DX9sIqqvKsjG8</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-white">Playlist do YouTube</label>
                            <input type="text" id="youtube-playlist"
                                class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400"
                                placeholder="Cole o ID da playlist">
                            <p class="text-xs text-gray-500 mt-1">Exemplo: PLu1OeKsX41Tdri-S7bSPiP7RBm67cpeY9</p>
                        </div>

                        <button id="save-music-btn"
                            class="w-full py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition">
                            Salvar Preferências Musicais
                        </button>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow mt-4">
                    <h3 class="font-medium mb-4 text-red-500">Zona de Perigo</h3>

                    <div class="space-y-4">
                        <button id="export-data-btn"
                            class="w-full py-2 border border-gray-300 text-gray-700 dark:border-gray-600 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                            Exportar Dados
                        </button>

                        <button id="import-data-btn"
                            class="w-full py-2 border border-gray-300 text-gray-700 dark:border-gray-600 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                            Importar Dados
                        </button>

                        <button id="reset-data-btn"
                            class="w-full py-2 border border-red-300 text-red-600 dark:border-red-600 dark:text-red-400 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition">
                            Redefinir Todos os Dados
                        </button>

                        <button id="delete-account-btn"
                            class="w-full py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                            Excluir Conta Permanentemente
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <nav
            class="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 shadow-lg border-t border-gray-200 dark:border-gray-700">
            <div class="max-w-md mx-auto flex justify-around">
                <button data-tab="dashboard"
                    class="tab-btn flex flex-col items-center py-3 px-4 text-primary-600 active-tab">
                    <i class="fas fa-home text-xl"></i>
                    <span class="text-xs mt-1">Início</span>
                </button>
                <button data-tab="techniques"
                    class="tab-btn flex flex-col items-center py-3 px-4 text-gray-500 dark:text-gray-400">
                    <i class="fas fa-lightbulb text-xl"></i>
                    <span class="text-xs mt-1">Técnicas</span>
                </button>
                <button data-tab="community"
                    class="tab-btn flex flex-col items-center py-3 px-4 text-gray-500 dark:text-gray-400">
                    <i class="fas fa-users text-xl"></i>
                    <span class="text-xs mt-1">Comunidade</span>
                </button>
                <button data-tab="focus"
                    class="tab-btn flex flex-col items-center py-3 px-4 text-gray-500 dark:text-gray-400">
                    <i class="fas fa-bolt text-xl"></i>
                    <span class="text-xs mt-1">Foco</span>
                </button>
                <button data-tab="config"
                    class="tab-btn flex flex-col items-center py-3 px-4 text-gray-500 dark:text-gray-400">
                    <i class="fas fa-cog text-xl"></i>
                    <span class="text-xs mt-1">Configurações</span>
                </button>
            </div>
        </nav>

        <!-- Modal para Anotações -->
        <div id="add-note-modal"
            class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4">
                <div class="flex justify-between items-center py-3 px-4 border-b dark:border-gray-700">
                    <h3 id="modal-title" class="font-bold text-gray-800 dark:text-white">Nova Anotação</h3>
                    <button id="close-note-modal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-4">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Título</label>
                        <input type="text" id="note-title"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400"
                            placeholder="Digite o título da anotação">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Conteúdo</label>
                        <textarea id="note-content"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400"
                            rows="5" placeholder="Digite o conteúdo da anotação"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Matéria</label>
                        <select id="note-subject"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400">
                            <option>Matemática</option>
                            <option>Português</option>
                            <option>História</option>
                            <option>Geografia</option>
                            <option>Biologia</option>
                            <option>Química</option>
                            <option>Física</option>
                            <option>Inglês</option>
                            <option value="outra">Outra</option>
                        </select>
                    </div>
                    <div id="new-subject-container" class="mb-4 hidden">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Nova Matéria</label>
                        <input type="text" id="new-subject"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400"
                            placeholder="Digite o nome da nova matéria">
                    </div>
                </div>
                <div class="flex justify-end items-center gap-x-2 py-3 px-4 border-t dark:border-gray-700">
                    <button id="cancel-note-btn"
                        class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:bg-gray-700">
                        Cancelar
                    </button>
                    <button id="save-note-btn"
                        class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-primary-600 text-white hover:bg-primary-700 disabled:opacity-50 disabled:pointer-events-none">
                        Salvar Anotação
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal para Eventos -->
        <div id="add-event-modal"
            class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4">
                <div class="flex justify-between items-center py-3 px-4 border-b dark:border-gray-700">
                    <h3 class="font-bold text-gray-800 dark:text-white" id="modal-title">Novo Evento</h3>
                    <button id="close-event-modal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-4">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Título</label>
                        <input type="text" id="event-title"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400"
                            placeholder="Digite o título do evento">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Data</label>
                        <input type="date" id="event-date"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Hora</label>
                        <input type="time" id="event-time"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Descrição</label>
                        <textarea id="event-description"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400"
                            rows="3" placeholder="Digite a descrição do evento"></textarea>
                    </div>
                </div>
                <div class="flex justify-end items-center gap-x-2 py-3 px-4 border-t dark:border-gray-700">
                    <button id="cancel-event-btn"
                        class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:bg-gray-700">
                        Cancelar
                    </button>
                    <button id="save-event-btn"
                        class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-primary-600 text-white hover:bg-primary-700 disabled:opacity-50 disabled:pointer-events-none">
                        Salvar Evento
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal para Resumos -->
        <div id="add-summary-modal"
            class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4">
                <div class="flex justify-between items-center py-3 px-4 border-b dark:border-gray-700">
                    <h3 class="font-bold text-gray-800 dark:text-white">Novo Resumo</h3>
                    <button id="close-summary-modal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-4">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Título</label>
                        <input type="text" id="summary-title"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400"
                            placeholder="Digite o título do resumo">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Matéria</label>
                        <select id="summary-subject"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400">
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Conteúdo</label>
                        <textarea id="summary-content"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400"
                            rows="6" placeholder="Digite o conteúdo do resumo"></textarea>
                    </div>
                </div>
                <div class="flex justify-end items-center gap-x-2 py-3 px-4 border-t dark:border-gray-700">
                    <button id="cancel-summary-btn"
                        class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:bg-gray-700">
                        Cancelar
                    </button>
                    <button id="save-summary-btn"
                        class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-primary-600 text-white hover:bg-primary-700 disabled:opacity-50 disabled:pointer-events-none">
                        Salvar Resumo
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal para Lembretes -->
        <div id="add-reminder-modal"
            class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4">
                <div class="flex justify-between items-center py-3 px-4 border-b dark:border-gray-700">
                    <h3 class="font-bold text-gray-800 dark:text-white">Novo Lembrete</h3>
                    <button id="close-reminder-modal"
                        class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-4">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Título</label>
                        <input type="text" id="reminder-title"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400"
                            placeholder="Digite o título do lembrete">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Data</label>
                        <input type="date" id="reminder-date"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Hora</label>
                        <input type="time" id="reminder-time"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Prioridade</label>
                        <select id="reminder-priority"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400">
                            <option value="baixa">Baixa</option>
                            <option value="media" selected>Média</option>
                            <option value="alta">Alta</option>
                        </select>
                    </div>
                </div>
                <div class="flex justify-end items-center gap-x-2 py-3 px-4 border-t dark:border-gray-700">
                    <button id="cancel-reminder-btn"
                        class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:bg-gray-700">
                        Cancelar
                    </button>
                    <button id="save-reminder-btn"
                        class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-primary-600 text-white hover:bg-primary-700 disabled:opacity-50 disabled:pointer-events-none">
                        Salvar Lembrete
                    </button>
                </div>
            </div>
        </div>
        <!-- Substitua o modal existente por este (já com botão de edição) -->
        <div id="reminder-actions-modal"
            class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4">
                <div class="flex justify-between items-center py-3 px-4 border-b dark:border-gray-700">
                    <h3 class="font-bold text-gray-800 dark:text-white">Editar Lembrete</h3>
                    <button id="close-reminder-actions-modal"
                        class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-4">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Título</label>
                        <input type="text" id="edit-reminder-title"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Data</label>
                        <input type="date" id="edit-reminder-date"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Hora</label>
                        <input type="time" id="edit-reminder-time"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 dark:text-white">Prioridade</label>
                        <select id="edit-reminder-priority"
                            class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400">
                            <option value="baixa">Baixa</option>
                            <option value="media" selected>Média</option>
                            <option value="alta">Alta</option>
                        </select>
                    </div>
                </div>
                <div class="flex justify-end items-center gap-x-2 py-3 px-4 border-t dark:border-gray-700">
                    <button id="cancel-edit-reminder"
                        class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:bg-gray-700">
                        Cancelar
                    </button>
                    <button id="save-edit-reminder"
                        class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-primary-600 text-white hover:bg-primary-700 disabled:opacity-50 disabled:pointer-events-none">
                        Salvar Alterações
                    </button>
                </div>
            </div>
        </div>
        <!-- Painel de Notificações -->
        <div id="notifications-panel"
            class="fixed inset-y-0 right-0 z-50 w-80 bg-white dark:bg-gray-800 shadow-lg transform translate-x-full transition-transform duration-300 ease-in-out">
            <div class="flex justify-between items-center p-4 border-b dark:border-gray-700">
                <h3 class="font-bold text-lg">Eventos de Hoje</h3>
                <button id="close-notifications" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4 overflow-y-auto max-h-screen pb-20">
                <div id="notifications-container" class="space-y-3">
                </div>
            </div>
        </div>

        <!-- Menu de Ações das Anotações -->
        <div id="note-actions-menu" class="note-actions-menu">
            <button id="edit-note-action"
                class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-t text-sm">
                <i class="fas fa-edit mr-2"></i> Editar
            </button>
            <button id="delete-note-action"
                class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-b text-sm text-red-500">
                <i class="fas fa-trash mr-2"></i> Excluir
            </button>
        </div>
    </div>

    <div id="youtube-player-container" style="display: none;">
        <iframe id="youtube-player" width="0" height="0" src="" frameborder="0" allow="autoplay" allowfullscreen>
        </iframe>
    </div>

    <script>
        async function fetchWithAuth(url, options = {}) {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                window.location.href = '/login';
                return Promise.reject('Não autenticado');
            }

            options.headers = {
                ...options.headers,
                'Authorization': `Bearer ${token}`
            };

            const response = await fetch(url, options);

            if (response.status === 401) {
                // Token inválido ou expirado
                localStorage.removeItem('jwtToken');
                window.location.href = '/login';
                return Promise.reject('Sessão expirada');
            }

            return response;
        }

        async function loadAppState() {
            try {
                const res = await fetchWithAuth("/api/data");
                // if (!res.ok) throw new Error("Failed to fetch data");
                const data = await res.json();

                AppState.notes = data.notes || [];
                AppState.reminders = data.reminders || [];
                AppState.studyLog = data.studyLog || {};
                AppState.subjects = data.subjects || [];
                AppState.events = data.events || [];
                AppState.config = data.config || {};

                console.log('Dados carregados:', data); // Debug

                NotesManager.renderNotes();
                RemindersManager.renderReminders();
                DashboardManager.updateTaskProgress();
                DashboardManager.updateStudyTime();
            } catch (error) {
                console.error("Error loading app state:", error);
                AppState.notes = [];
                AppState.reminders = [];
                AppState.studyLog = {};
                AppState.subjects = [];
                AppState.config = {};
            }
        }

        async function initApp() {
            await loadAppState();
            NotificationsManager.renderNotifications();

            DashboardManager.updateStudyTime();
            DashboardManager.renderStudyChart();
            DashboardManager.updateTaskProgress();
            DashboardManager.updateStudyTime();
            DashboardManager.renderWeeklyChart();


            // Forçar dashboard como aba inicial
            const sections = document.querySelectorAll('main > section');
            const tabButtons = document.querySelectorAll('.tab-btn');
            TabManager.switchTab('dashboard', null, tabButtons, sections);

            // Inicializar outros managers
            RemindersManager.renderReminders();
            CalendarManager.init();

            document.getElementById('study-range').addEventListener('change', () => {
                DashboardManager.renderStudyChart();
            });
            TimerManager.init();
        }

        initApp();

        async function saveAppState() {
            try {
                const res = await fetchWithAuth("/api/data", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        notes: AppState.notes,
                        reminders: AppState.reminders,
                        studyLog: AppState.studyLog,
                        subjects: AppState.subjects,
                        config: AppState.config,
                        events: AppState.events  // Certifique-se que isso está incluído
                    })
                });

                if (!res.ok) throw new Error("Failed to save data");
            } catch (error) {
                console.error("Error saving app state:", error);
            }
        }

        // App State
        const AppState = {
            notes: [],
            reminders: [],
            studyLog: {},
            subjects: [],
            config: {},
            timer: {
                timeLeft: 25 * 60,
                isRunning: false,
                selectedDuration: 25,
                interval: null
            },
            currentEditingNote: null,
            events: [],
            summaries: [],
            currentDate: new Date(),
            currentMonth: new Date().getMonth(),
            currentYear: new Date().getFullYear()
        };

        loadAppState();

        // Theme Management
        const ThemeManager = {
            init() {
                const savedTheme = localStorage.getItem('theme');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

                if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                    document.documentElement.classList.add('dark');
                }

                document.getElementById('theme-toggle').addEventListener('click', this.toggle);
            },

            toggle() {
                const isDark = document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
            }
        };

        let currentActiveTab = 'dashboard';

        // No TabManager
        const TabManager = {
            switchTab(tabId, activeButton, allButtons, allSections) {
                console.log('Mudando para aba:', tabId)

                if (tabId === 'notifications') return;

                currentActiveTab = tabId;

                // Atualiza a aba ativa no localStorage
                localStorage.setItem('activeTab', tabId);

                this.updateActiveTab(tabId, allButtons);
                this.switchToSection(tabId, allSections);

                // Adicione estas linhas para garantir que o conteúdo seja renderizado
                if (tabId === 'reminders') {
                    RemindersManager.renderReminders();
                }
            },

            init() {
                localStorage.setItem('activeTab', 'dashboard'); // força início no dashboard
                const savedTab = 'dashboard';


                const tabButtons = document.querySelectorAll('.tab-btn');
                const sections = document.querySelectorAll('main > section');

                this.switchToSection(savedTab, sections);
                this.updateActiveTab(savedTab, tabButtons);


                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const tabId = button.getAttribute('data-tab');
                        this.switchTab(tabId, button, tabButtons, sections);
                    });
                });

                document.getElementById('home-btn').addEventListener('click', () => {
                    this.switchToSection('dashboard', document.querySelectorAll('main > section'));
                    this.updateActiveTab('dashboard', document.querySelectorAll('.tab-btn'));
                });

                // Botões de ação rápida
                document.getElementById('calendar-btn').addEventListener('click', () => {
                    this.switchToSection('calendar', sections);
                    this.updateActiveTab('calendar', tabButtons);
                });

                document.getElementById('summaries-btn').addEventListener('click', () => {
                    this.switchToSection('summaries', sections);
                    this.updateActiveTab('notes', tabButtons); // Usar notes como fallback
                });

                // No TabManager.init():
                document.getElementById('reminders-btn').addEventListener('click', () => {
                    const sections = document.querySelectorAll('main > section');
                    const tabButtons = document.querySelectorAll('.tab-btn');
                    this.switchTab('reminders', null, tabButtons, sections);
                });

                document.getElementById('materials-btn').addEventListener('click', () => {
                    const sections = document.querySelectorAll('main > section');
                    const tabButtons = document.querySelectorAll('.tab-btn');
                    this.switchTab('materials', null, tabButtons, sections);
                });

                // document.getElementById('community-btn').addEventListener('click', () => {
                //     this.switchToSection('community', sections);
                //     this.updateActiveTab('community', tabButtons);
                // });

                // Técnicas de estudo
                document.querySelectorAll('.technique-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const technique = btn.dataset.technique;
                        this.handleTechnique(technique);
                    });
                });

                DashboardManager.updateStudyTime();
                DashboardManager.updateTaskProgress();
                DashboardManager.renderWeeklyChart();
            },

            updateActiveTab(tabId, allButtons) {
                allButtons.forEach(btn => {
                    btn.classList.remove('active-tab', 'text-primary-600');
                    btn.classList.add('text-gray-500', 'dark:text-gray-400');
                });

                const activeButton = document.querySelector(`[data-tab="${tabId}"]`);
                if (activeButton) {
                    activeButton.classList.add('active-tab', 'text-primary-600');
                    activeButton.classList.remove('text-gray-500', 'dark:text-gray-400');
                }
            },

            switchToSection(sectionId, allSections) {
                allSections.forEach(section => {
                    section.classList.add('hidden');
                    if (section.id === sectionId) {
                        section.classList.remove('hidden');
                        section.classList.add('fade-in');
                    }
                });
            },

            handleTechnique(technique) {
                switch (technique) {
                    case 'pomodoro':
                        // Mudar para a aba de foco
                        const sections = document.querySelectorAll('main > section');
                        const tabButtons = document.querySelectorAll('.tab-btn');
                        this.switchToSection('focus', sections);
                        this.updateActiveTab('focus', tabButtons);
                        break;
                    case 'feynman':
                        alert('Técnica Feynman: Tente explicar o conceito que você está estudando como se estivesse ensinando para uma criança de 5 anos. Isso ajuda a identificar lacunas no seu conhecimento!');
                        break;
                    case 'mindmap':
                        alert('Mapa Mental: Comece com o tópico principal no centro e vá adicionando ramificações com subtópicos relacionados. Use cores e símbolos para facilitar a memorização!');
                        break;
                }
            }
        };

        // Notes Management
        const NotesManager = {
            init() {
                this.loadNotes();
                this.loadSubjects();
                this.renderNotes();
                this.bindEvents();
                this.updateSubjectDropdown();
            },

            loadNotes() {
                const savedNotes = localStorage.getItem('studyBuddyNotes');
                if (savedNotes) {
                    AppState.notes = JSON.parse(savedNotes);
                }
            },

            loadSubjects() {
                const savedSubjects = localStorage.getItem('studyBuddySubjects');
                if (savedSubjects) {
                    AppState.subjects = JSON.parse(savedSubjects);
                }
            },

            saveNotes() {
                saveAppState();
            },

            saveSubjects() {
                localStorage.setItem('studyBuddySubjects', JSON.stringify(AppState.subjects));
            },

            renderNotes() {
                const container = document.getElementById('notes-container');
                if (!container) return;

                container.innerHTML = '';

                AppState.notes.forEach(note => {
                    const noteElement = document.createElement('div');
                    noteElement.className = 'note-card bg-white dark:bg-gray-800 rounded-lg p-4 shadow h-40 flex flex-col cursor-pointer';
                    noteElement.innerHTML = `
                        <h3 class="font-medium mb-2">${note.title}</h3>
                        <p class="text-sm text-gray-500 flex-grow overflow-hidden">${note.content.substring(0, 60)}...</p>
                        <div class="flex justify-between items-center text-xs text-gray-400">
                            <span>${note.date}</span>
                            <button class="note-actions-btn p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded" data-note-id="${note.id}">
                                <i class="fas fa-ellipsis-h"></i>
                            </button>
                        </div>
                    `;
                    container.appendChild(noteElement);
                });

                // Bind note action events
                document.querySelectorAll('.note-actions-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.showNoteActions(parseInt(btn.dataset.noteId), e);
                    });
                });
            },

            updateSubjectDropdown() {
                const noteSubjectSelect = document.getElementById('note-subject');
                const summarySubjectSelect = document.getElementById('summary-subject');

                if (noteSubjectSelect) {
                    const currentValue = noteSubjectSelect.value;
                    noteSubjectSelect.innerHTML = '';

                    AppState.subjects.forEach(subject => {
                        const option = document.createElement('option');
                        option.value = subject;
                        option.textContent = subject;
                        noteSubjectSelect.appendChild(option);
                    });

                    const outraOption = document.createElement('option');
                    outraOption.value = 'outra';
                    outraOption.textContent = 'Outra';
                    noteSubjectSelect.appendChild(outraOption);

                    if (currentValue) {
                        noteSubjectSelect.value = currentValue;
                    }
                }

                if (summarySubjectSelect) {
                    summarySubjectSelect.innerHTML = '';

                    AppState.subjects.forEach(subject => {
                        const option = document.createElement('option');
                        option.value = subject;
                        option.textContent = subject;
                        summarySubjectSelect.appendChild(option);
                    });
                }
            },

            showNoteActions(noteId, event) {
                const menu = document.getElementById('note-actions-menu');
                const rect = event.target.getBoundingClientRect();

                menu.style.top = `${rect.bottom + window.scrollY}px`;
                menu.style.left = `${rect.left + window.scrollX - 100}px`;
                menu.classList.add('show');

                menu.dataset.noteId = noteId;

                const closeMenu = (e) => {
                    if (!menu.contains(e.target)) {
                        menu.classList.remove('show');
                        document.removeEventListener('click', closeMenu);
                    }
                };

                setTimeout(() => {
                    document.addEventListener('click', closeMenu);
                }, 10);
            },

            bindEvents() {
                document.getElementById('add-note-btn').addEventListener('click', () => {
                    this.openModal();
                });

                document.getElementById('close-note-modal').addEventListener('click', () => {
                    this.closeModal();
                });

                document.getElementById('cancel-note-btn').addEventListener('click', () => {
                    this.closeModal();
                });

                document.getElementById('save-note-btn').addEventListener('click', () => {
                    this.saveNote();
                });

                document.getElementById('edit-note-action').addEventListener('click', () => {
                    const noteId = parseInt(document.getElementById('note-actions-menu').dataset.noteId);
                    this.editNote(noteId);
                    document.getElementById('note-actions-menu').classList.remove('show');
                });

                document.getElementById('delete-note-action').addEventListener('click', () => {
                    const noteId = parseInt(document.getElementById('note-actions-menu').dataset.noteId);
                    this.deleteNote(noteId);
                    document.getElementById('note-actions-menu').classList.remove('show');
                });

                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closeModal();
                    }
                });

                document.getElementById('add-note-modal').addEventListener('click', (e) => {
                    if (e.target === document.getElementById('add-note-modal')) {
                        this.closeModal();
                    }
                });

                document.getElementById('note-subject').addEventListener('change', (e) => {
                    const newSubjectContainer = document.getElementById('new-subject-container');
                    if (e.target.value === 'outra') {
                        newSubjectContainer.classList.remove('hidden');
                    } else {
                        newSubjectContainer.classList.add('hidden');
                    }
                });
            },

            openModal(note = null) {
                const modal = document.getElementById('add-note-modal');
                const title = document.getElementById('modal-title');
                const saveBtn = document.getElementById('save-note-btn');
                const newSubjectContainer = document.getElementById('new-subject-container');

                AppState.currentEditingNote = note;

                if (note) {
                    title.textContent = 'Editar Anotação';
                    saveBtn.textContent = 'Atualizar Anotação';
                    document.getElementById('note-title').value = note.title;
                    document.getElementById('note-content').value = note.content;
                    document.getElementById('note-subject').value = note.subject;

                    if (!AppState.subjects.includes(note.subject)) {
                        document.getElementById('note-subject').value = 'outra';
                        newSubjectContainer.classList.remove('hidden');
                        document.getElementById('new-subject').value = note.subject;
                    } else {
                        newSubjectContainer.classList.add('hidden');
                    }
                } else {
                    title.textContent = 'Nova Anotação';
                    saveBtn.textContent = 'Salvar Anotação';
                    document.getElementById('note-title').value = '';
                    document.getElementById('note-content').value = '';
                    document.getElementById('note-subject').value = '';
                    document.getElementById('new-subject').value = '';
                    newSubjectContainer.classList.add('hidden');
                }

                modal.classList.remove('hidden');
            },

            closeModal() {
                document.getElementById('add-note-modal').classList.add('hidden');
                AppState.currentEditingNote = null;
            },

            saveNote() {
                const title = document.getElementById('note-title').value.trim();
                const content = document.getElementById('note-content').value.trim();
                let subject = document.getElementById('note-subject').value;

                if (subject === 'outra') {
                    subject = document.getElementById('new-subject').value.trim();

                    if (subject && !AppState.subjects.includes(subject)) {
                        AppState.subjects.push(subject);
                        this.saveSubjects();
                        this.updateSubjectDropdown();
                    }
                }

                if (!title || !content || !subject) {
                    alert('Por favor, preencha todos os campos obrigatórios.');
                    return;
                }

                const currentDate = new Date();
                const formattedDate = `${currentDate.getDate()} ${this.getMonthName(currentDate.getMonth())}`;

                if (AppState.currentEditingNote) {
                    const noteIndex = AppState.notes.findIndex(n => n.id === AppState.currentEditingNote.id);
                    if (noteIndex !== -1) {
                        AppState.notes[noteIndex] = {
                            ...AppState.notes[noteIndex],
                            title,
                            content,
                            subject,
                            date: formattedDate
                        };
                    }
                } else {
                    const newNote = {
                        id: Date.now(),
                        title,
                        content,
                        subject,
                        date: formattedDate
                    };
                    AppState.notes.unshift(newNote);
                }

                this.saveNotes();
                this.renderNotes();
                this.closeModal();
            },

            editNote(noteId) {
                const note = AppState.notes.find(n => n.id === noteId);
                if (note) {
                    this.openModal(note);
                }
            },

            deleteNote(noteId) {
                if (confirm('Tem certeza que deseja excluir esta anotação?')) {
                    AppState.notes = AppState.notes.filter(n => n.id !== noteId);
                    this.saveNotes();
                    this.renderNotes();
                }
            },

            getMonthName(monthIndex) {
                const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                return months[monthIndex];
            }
        };

        // Timer Management
        const TimerManager = {
            init() {
                this.bindTimerControls();
                this.setupBackgroundMusicToggle();
                this.updateTimerDisplay();
            },

            bindTimerControls() {
                const startBtn = document.getElementById('timer-start-btn');
                const resetBtn = document.getElementById('timer-reset-btn');
                const customBtn = document.getElementById('set-custom-time');

                document.querySelectorAll('.timer-duration-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const minutes = parseInt(btn.getAttribute('data-duration'));
                        AppState.timer.selectedDuration = minutes;
                        AppState.timer.timeLeft = minutes * 60;
                        this.updateTimerDisplay();
                    });
                });

                customBtn.addEventListener('click', () => {
                    const input = document.getElementById('custom-minutes');
                    const minutes = parseInt(input.value);
                    if (!isNaN(minutes) && minutes > 0) {
                        AppState.timer.selectedDuration = minutes;
                        AppState.timer.timeLeft = minutes * 60;
                        this.updateTimerDisplay();
                    }
                });

                startBtn.addEventListener('click', () => {
                    if (!AppState.timer.isRunning) {
                        this.startTimer();
                    }
                });

                resetBtn.addEventListener('click', () => {
                    this.resetTimer();
                });
            },

            updateTimerDisplay() {
                const display = document.getElementById('timer-display');
                const minutes = Math.floor(AppState.timer.timeLeft / 60);
                const seconds = AppState.timer.timeLeft % 60;
                display.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            },

            startTimer() {
                AppState.timer.isRunning = true;
                AppState.timer.interval = setInterval(() => {
                    if (AppState.timer.timeLeft > 0) {
                        AppState.timer.timeLeft--;
                        this.updateTimerDisplay();
                    } else {
                        this.stopTimer();
                        if (document.getElementById('timer-notifications').checked) {
                            alert("Tempo esgotado! Hora de fazer uma pausa.");
                        }
                    }
                }, 1000);
            },

            stopTimer() {
                clearInterval(AppState.timer.interval);
                AppState.timer.isRunning = false;
            },

            resetTimer() {
                this.stopTimer();
                AppState.timer.timeLeft = AppState.timer.selectedDuration * 60;
                this.updateTimerDisplay();
            },

            setupBackgroundMusicToggle() {
                const toggle = document.getElementById('timer-sound');
                const playerBox = document.getElementById('custom-music-player');
                const titleElem = document.getElementById('current-song-title');
                const timeElem = document.getElementById('song-time');
                const playBtn = document.getElementById('toggle-play');
                const nextBtn = document.getElementById('next-song');
                const prevBtn = document.getElementById('prev-song');
                const closeBtn = document.getElementById('close-music-player');
                const playlistId = AppState.config.youtubePlaylist || "OLAK5uy_n7j7fvy5z8rCPguuoV_Cv8dRuRFMQuTbM";

                // Carregar estado salvo ou usar false como padrão
                const savedState = localStorage.getItem('musicEnabled');
                const isMusicEnabled = savedState ? JSON.parse(savedState) : false;

                // Definir estado inicial do toggle e do player
                toggle.checked = isMusicEnabled;
                playerBox.style.display = isMusicEnabled ? 'block' : 'none';

                let ytPlayer;
                let updateTimeInterval;

                function createPlayer() {
                    ytPlayer = new YT.Player('youtube-player', {
                        height: '0',
                        width: '0',
                        playerVars: {
                            listType: 'playlist',
                            list: playlistId,
                            autoplay: isMusicEnabled ? 1 : 0,
                            loop: 1
                        },
                        events: {
                            onReady: () => {
                                if (isMusicEnabled) {
                                    ytPlayer.playVideo();
                                    titleElem.textContent = ytPlayer.getVideoData().title;
                                    playBtn.innerHTML = '<i class="fas fa-pause"></i>';
                                    playBtn.classList.add('playing');
                                } else {
                                    titleElem.textContent = "Nenhuma música";
                                    playBtn.innerHTML = '<i class="fas fa-play"></i>';
                                    playBtn.classList.add('paused');
                                }
                            },
                            onStateChange: (event) => {
                                if (event.data === YT.PlayerState.PLAYING) {
                                    updateTimeInterval = setInterval(() => {
                                        const current = ytPlayer.getCurrentTime();
                                        const minutes = Math.floor(current / 60);
                                        const seconds = Math.floor(current % 60);
                                        timeElem.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                                        titleElem.textContent = ytPlayer.getVideoData().title;
                                    }, 1000);
                                } else {
                                    clearInterval(updateTimeInterval);
                                }
                            }
                        }
                    });
                }

                // Carrega API do YouTube
                if (!window.YT) {
                    const tag = document.createElement('script');
                    tag.src = "https://www.youtube.com/iframe_api";
                    document.head.appendChild(tag);
                }

                window.onYouTubeIframeAPIReady = createPlayer;

                toggle.addEventListener('change', function () {
                    const isEnabled = this.checked;
                    localStorage.setItem('musicEnabled', JSON.stringify(isEnabled));

                    if (ytPlayer) {
                        if (isEnabled) {
                            playerBox.style.display = 'block';
                            ytPlayer.playVideo();
                            playBtn.innerHTML = '<i class="fas fa-pause"></i>';
                            playBtn.classList.add('playing');
                            playBtn.classList.remove('paused');
                        } else {
                            ytPlayer.pauseVideo();
                            playerBox.style.display = 'none';
                            playBtn.innerHTML = '<i class="fas fa-play"></i>';
                            playBtn.classList.remove('playing');
                            playBtn.classList.add('paused');
                        }
                    }
                });

                playBtn.addEventListener('click', () => {
                    const state = ytPlayer.getPlayerState();
                    if (state === YT.PlayerState.PLAYING) {
                        ytPlayer.pauseVideo();
                        playBtn.innerHTML = '<i class="fas fa-play"></i>';
                        playBtn.classList.remove('playing');
                        playBtn.classList.add('paused');
                    } else {
                        ytPlayer.playVideo();
                        playBtn.innerHTML = '<i class="fas fa-pause"></i>';
                        playBtn.classList.remove('paused');
                        playBtn.classList.add('playing');
                    }
                });

                nextBtn.addEventListener('click', () => ytPlayer.nextVideo());
                prevBtn.addEventListener('click', () => ytPlayer.previousVideo());

                closeBtn.addEventListener('click', () => {
                    toggle.checked = false;
                    localStorage.setItem('musicEnabled', 'false');
                    ytPlayer.pauseVideo();
                    playerBox.style.display = 'none';
                });
            }
        };

        const DashboardManager = {
            updateStudyTime() {
                const todayStr = new Date().toISOString().split('T')[0];
                const minutes = AppState.studyLog[todayStr] || 0;
                const hours = Math.floor(minutes / 60);
                const mins = minutes % 60;
                const element = document.getElementById('study-time');
                if (element) element.textContent = `${hours}h ${mins}m`;
            },

            renderStudyChart() {
                const container = document.getElementById('study-chart');
                if (!container) return;

                const studyLog = AppState.studyLog || {};
                const today = new Date();
                const option = document.getElementById('study-range')?.value || 'Esta Semana';

                let items = [];

                if (option === 'Esta Semana') {
                    const start = new Date(today);
                    start.setDate(today.getDate() - today.getDay());
                    for (let i = 0; i < 7; i++) {
                        const current = new Date(start);
                        current.setDate(start.getDate() + i);
                        const key = current.toISOString().split('T')[0];
                        const minutes = studyLog[key] || 0;
                        items.push({ label: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'][i], value: minutes });
                    }
                }

                if (option === 'Este Mês') {
                    const year = today.getFullYear();
                    const month = today.getMonth();
                    const daysInMonth = new Date(year, month + 1, 0).getDate();

                    for (let i = 1; i <= daysInMonth; i++) {
                        const date = `${year}-${(month + 1).toString().padStart(2, '0')}-${i.toString().padStart(2, '0')}`;
                        const minutes = studyLog[date] || 0;
                        items.push({ label: i.toString(), value: minutes });
                    }
                }

                if (option === 'Este Ano') {
                    const year = today.getFullYear();
                    for (let i = 0; i < 12; i++) {
                        let total = 0;
                        for (let d = 1; d <= 31; d++) {
                            const date = `${year}-${(i + 1).toString().padStart(2, '0')}-${d.toString().padStart(2, '0')}`;
                            total += studyLog[date] || 0;
                        }
                        const label = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'][i];
                        items.push({ label, value: total });
                    }
                }

                container.innerHTML = '';
                items.forEach(item => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'flex flex-col items-center justify-end w-10'; // largura fixa

                    const bar = document.createElement('div');
                    bar.className = 'bg-primary-500 rounded-t';
                    bar.style.height = `${Math.min(64, item.value * 2)}px`;
                    bar.style.width = '100%'; // mesma largura que wrapper

                    const label = document.createElement('span');
                    label.className = 'text-xs mt-1 text-center leading-tight';
                    label.style.minHeight = '1rem'; // evita pular

                    label.textContent = item.label;

                    wrapper.appendChild(bar);
                    wrapper.appendChild(label);
                    container.appendChild(wrapper);
                });

                const containerWrapper = document.getElementById('study-chart-wrapper');
                const chart = document.getElementById('study-chart');

                if (option === 'Esta Semana') {
                    chart.classList.remove('min-w-[500px]', 'min-w-[800px]');
                    chart.classList.add('w-full', 'justify-between');
                } else if (option === 'Este Mês') {
                    chart.classList.remove('w-full', 'justify-between');
                    chart.classList.add('min-w-[1000px]');
                } else if (option === 'Este Ano') {
                    chart.classList.remove('w-full', 'justify-between');
                    chart.classList.add('min-w-[600px]');
                }
            },


            updateTaskProgress() {
                const today = new Date();
                const todayStr = today.toISOString().split('T')[0];

                const todayReminders = AppState.reminders.filter(r => r.date === todayStr);
                const overdueReminders = AppState.reminders.filter(r =>
                    !r.completed && new Date(r.date) < today && r.date !== todayStr
                );

                // Combinar tarefas de hoje e atrasadas
                const allPendingReminders = [...todayReminders, ...overdueReminders];
                const total = allPendingReminders.length;
                const completed = allPendingReminders.filter(r => r.completed).length;

                const counter = document.getElementById('task-counter');
                if (counter) {
                    counter.textContent = `${completed}/${total}`;
                }
            },

            renderWeeklyChart() {
                const studyLog = AppState.studyLog || {};
                const today = new Date();
                const startOfWeek = new Date(today);
                startOfWeek.setDate(today.getDate() - today.getDay()); // domingo

                for (let i = 0; i < 7; i++) {
                    const current = new Date(startOfWeek);
                    current.setDate(current.getDate() + i);
                    const key = current.toISOString().split('T')[0];
                    const minutes = studyLog[key] || 0;
                    const height = Math.min(64, minutes * 2); // altura visual proporcional
                    const el = document.querySelector(`[data-day="${(i + 1)}"] div`);
                    if (el) el.style.height = `${height}px`;
                }
            }
        };
        // Calendar Management
        const CalendarManager = {
            init() {
                this.renderCalendar();
                this.renderUpcomingEvents();
                this.bindEvents();
            },

            bindEvents() {
                document.getElementById('prev-month').addEventListener('click', () => {
                    this.changeMonth(-1);
                });

                document.getElementById('next-month').addEventListener('click', () => {
                    this.changeMonth(1);
                });

                document.getElementById('add-event-btn').addEventListener('click', () => {
                    this.openEventModal();
                });

                document.getElementById('close-event-modal').addEventListener('click', () => {
                    this.closeEventModal();
                });

                document.getElementById('cancel-event-btn').addEventListener('click', () => {
                    this.closeEventModal();
                });

                document.getElementById('save-event-btn').addEventListener('click', () => {
                    this.saveEvent();
                });
            },

            changeMonth(direction) {
                AppState.currentMonth += direction;

                if (AppState.currentMonth > 11) {
                    AppState.currentMonth = 0;
                    AppState.currentYear++;
                } else if (AppState.currentMonth < 0) {
                    AppState.currentMonth = 11;
                    AppState.currentYear--;
                }

                this.renderCalendar();
            },

            renderCalendar() {
                const calendarDays = document.getElementById('calendar-days');
                if (!calendarDays) return;

                calendarDays.innerHTML = '';

                const firstDay = new Date(AppState.currentYear, AppState.currentMonth, 1);
                const lastDay = new Date(AppState.currentYear, AppState.currentMonth + 1, 0);

                // Ajuste aqui: usar getDay() que retorna 0 (Domingo) a 6 (Sábado)
                const startDay = firstDay.getDay();
                const totalDays = lastDay.getDate();
                const today = new Date();

                const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                    'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                const monthYearElement = document.getElementById('calendar-month-year');
                if (monthYearElement) {
                    monthYearElement.textContent = `${monthNames[AppState.currentMonth]} ${AppState.currentYear}`;
                }

                // Dias vazios no início - garantir que comece no Domingo (0)
                for (let i = 0; i < startDay; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day opacity-0';
                    calendarDays.appendChild(emptyDay);
                }

                // Dias do mês
                for (let i = 1; i <= totalDays; i++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';

                    // Verificar se é o dia atual
                    if (i === today.getDate() &&
                        AppState.currentMonth === today.getMonth() &&
                        AppState.currentYear === today.getFullYear()) {
                        dayElement.classList.add('today');
                    }

                    const dateStr = `${AppState.currentYear}-${(AppState.currentMonth + 1).toString().padStart(2, '0')}-${i.toString().padStart(2, '0')}`;
                    const hasEvent = AppState.events.some(event => event.date === dateStr);

                    if (hasEvent) {
                        dayElement.classList.add('has-event');
                    }

                    dayElement.textContent = i;
                    dayElement.addEventListener('click', () => {
                        this.showEventsForDay(dateStr);
                    });

                    calendarDays.appendChild(dayElement);
                }

                // Preencher os dias restantes para completar a última semana (opcional)
                const totalCells = startDay + totalDays;
                const remainingDays = 7 - (totalCells % 7);
                if (remainingDays < 7) { // Só adiciona se não for uma semana completa
                    for (let i = 0; i < remainingDays; i++) {
                        const emptyDay = document.createElement('div');
                        emptyDay.className = 'calendar-day opacity-0';
                        calendarDays.appendChild(emptyDay);
                    }
                }
            },

            renderUpcomingEvents() {
                const upcomingEvents = document.getElementById('upcoming-events');
                if (!upcomingEvents) return;

                upcomingEvents.innerHTML = '';

                const sortedEvents = [...AppState.events].sort((a, b) => {
                    const dateA = new Date(`${a.date}T${a.time}`);
                    const dateB = new Date(`${b.date}T${b.time}`);
                    return dateA - dateB;
                });

                const today = new Date().toISOString().split('T')[0];
                const futureEvents = sortedEvents.filter(event => event.date >= today);

                if (futureEvents.length === 0) {
                    upcomingEvents.innerHTML = '<p class="text-center text-gray-500 py-4">Nenhum evento agendado</p>';
                    return;
                }

                const nextEvents = futureEvents.slice(0, 3);

                nextEvents.forEach(event => {
                    const [year, month, day] = event.date.split('-');
                    const formattedDate = `${parseInt(day)} ${this.getMonthName(parseInt(month) - 1)}`;


                    const eventElement = document.createElement('div');
                    eventElement.className = 'flex items-start p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600';
                    eventElement.innerHTML = `
                        <div class="p-2 bg-primary-500 rounded-full mr-3">
                            <i class="fas fa-calendar text-white text-xs"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-medium">${event.title}</h4>
                            <p class="text-sm text-gray-500">${formattedDate} às ${event.time}</p>
                            ${event.description ? `<p class="text-xs text-gray-400 mt-1">${event.description}</p>` : ''}
                        </div>
                    `;

                    eventElement.addEventListener('click', () => {
                        this.showEventsForDay(event.date);
                    });

                    upcomingEvents.appendChild(eventElement);
                });
            },

            showEventsForDay(dateStr) {
                const eventsForDay = AppState.events.filter(event => event.date === dateStr);

                if (eventsForDay.length > 0) {
                    // Criar um modal para mostrar os eventos com opção de editar/excluir
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50';
                    modal.innerHTML = `
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto">
                            <div class="flex justify-between items-center py-3 px-4 border-b dark:border-gray-700">
                                <h3 class="font-bold text-gray-800 dark:text-white">Eventos para ${this.formatFullDate(dateStr)}</h3>
                                <button class="close-events-modal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="p-4">
                                ${eventsForDay.map(event => `
                                    <div class="event-item mb-4 p-3 border-b dark:border-gray-700 last:border-0">
                                        <div class="flex justify-between items-start">
                                            <h4 class="font-medium">${event.title}</h4>
                                            <span class="text-sm text-gray-500">${event.time}</span>
                                        </div>
                                        ${event.description ? `<p class="text-sm text-gray-600 dark:text-gray-300 mt-1">${event.description}</p>` : ''}
                                        <div class="flex justify-end mt-2 space-x-2">
                                            <button class="edit-event-btn py-1 px-2 text-sm bg-primary-100 dark:bg-primary-900 text-primary-600 dark:text-primary-300 rounded" data-event-id="${event.id}">
                                                <i class="fas fa-edit mr-1"></i> Editar
                                            </button>
                                            <button class="delete-event-btn py-1 px-2 text-sm bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-300 rounded" data-event-id="${event.id}">
                                                <i class="fas fa-trash mr-1"></i> Excluir
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="flex justify-end items-center gap-x-2 py-3 px-4 border-t dark:border-gray-700">
                                <button class="add-event-for-day py-2 px-3 inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-primary-600 text-white hover:bg-primary-700">
                                    <i class="fas fa-plus mr-1"></i> Adicionar Evento
                                </button>
                            </div>
                        </div>
                    `;

                    document.body.appendChild(modal);

                    // Adicionar event listeners
                    modal.querySelector('.close-events-modal').addEventListener('click', () => {
                        modal.remove();
                    });

                    modal.querySelectorAll('.edit-event-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            const eventId = parseInt(btn.dataset.eventId);
                            const event = AppState.events.find(e => e.id === eventId);
                            if (event) {
                                this.openEventModal(event);
                                modal.remove();
                            }
                        });
                    });

                    modal.querySelectorAll('.delete-event-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const eventId = parseInt(btn.dataset.eventId);
                            NotificationsManager.deleteEvent(eventId);
                        });
                    });

                    modal.querySelector('.add-event-for-day').addEventListener('click', () => {
                        this.openEventModal();
                        document.getElementById('event-date').value = dateStr;
                        modal.remove();
                    });

                    // Fechar modal ao clicar fora
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.remove();
                        }
                    });
                } else {
                    // Nenhum evento, oferecer para criar um
                    if (confirm(`Nenhum evento agendado para ${this.formatFullDate(dateStr)}. Deseja criar um novo evento?`)) {
                        this.openEventModal();
                        document.getElementById('event-date').value = dateStr;
                    }
                }
            },

            formatFullDate(dateStr) {
                const [year, month, day] = dateStr.split('-').map(Number);
                const date = new Date(year, month - 1, day); // cria localmente, sem UTC

                const monthName = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'][month - 1];

                return `${day} de ${monthName} de ${year}`;
            },

            openEventModal(event = null) {
                const modal = document.getElementById('add-event-modal');
                const title = document.getElementById('modal-title');
                const saveBtn = document.getElementById('save-event-btn');

                if (event) {
                    // Modo edição
                    title.textContent = 'Editar Evento';
                    saveBtn.textContent = 'Atualizar Evento';
                    saveBtn.dataset.eventId = event.id; // Adiciona o ID do evento ao botão

                    document.getElementById('event-title').value = event.title;
                    document.getElementById('event-date').value = event.date;
                    document.getElementById('event-time').value = event.time;
                    document.getElementById('event-description').value = event.description || '';
                } else {
                    // Modo criação
                    title.textContent = 'Novo Evento';
                    saveBtn.textContent = 'Salvar Evento';
                    delete saveBtn.dataset.eventId; // Remove qualquer ID existente

                    // Definir data padrão como hoje
                    const today = new Date().toISOString().split('T')[0];
                    document.getElementById('event-date').value = today;
                    document.getElementById('event-time').value = '12:00';
                    document.getElementById('event-title').value = '';
                    document.getElementById('event-description').value = '';
                }

                modal.classList.remove('hidden');
            },

            closeEventModal() {
                const modal = document.getElementById('add-event-modal');
                modal.classList.add('hidden');

                // Limpar campos
                document.getElementById('event-title').value = '';
                document.getElementById('event-date').value = '';
                document.getElementById('event-time').value = '';
                document.getElementById('event-description').value = '';

                // Remover ID de edição se existir
                const saveBtn = document.getElementById('save-event-btn');
                delete saveBtn.dataset.eventId;
            },

            saveEvent() {
                const title = document.getElementById('event-title').value.trim();
                const date = document.getElementById('event-date').value;
                const time = document.getElementById('event-time').value;
                const description = document.getElementById('event-description').value.trim();

                if (!title || !date || !time) {
                    alert("Por favor, preencha todos os campos obrigatórios.");
                    return;
                }

                const saveBtn = document.getElementById('save-event-btn');
                const isEditing = saveBtn.dataset.eventId;

                // Verificar se já existe um evento idêntico
                const existingEvent = AppState.events.find(e =>
                    e.title === title &&
                    e.date === date &&
                    e.time === time &&
                    (!isEditing || e.id !== parseInt(isEditing))
                );

                if (existingEvent) {
                    alert("Já existe um evento com esses detalhes.");
                    return;
                }
                if (isEditing) {
                    // Modo edição - atualizar evento existente
                    const eventId = parseInt(isEditing);
                    const eventIndex = AppState.events.findIndex(e => e.id === eventId);

                    if (eventIndex !== -1) {
                        AppState.events[eventIndex] = {
                            id: eventId,
                            title,
                            date,
                            time,
                            description
                        };
                    }
                } else {
                    // Modo criação - adicionar novo evento
                    const newEvent = {
                        id: Date.now(),
                        title,
                        date,
                        time,
                        description
                    };
                    AppState.events.push(newEvent);
                }

                saveAppState().then(() => {
                    this.renderCalendar();
                    this.renderUpcomingEvents();
                    this.closeEventModal();
                });
            },

            getMonthName(monthIndex) {
                const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                return months[monthIndex];
            }
        };

        // Summaries Management
        const SummariesManager = {
            init() {
                this.renderSummaries();
                this.bindEvents();
            },

            renderSummaries() {
                const container = document.getElementById('summaries-container');
                if (!container) return;

                container.innerHTML = '';

                AppState.summaries.forEach(summary => {
                    const summaryElement = document.createElement('div');
                    summaryElement.className = 'summary-card bg-white dark:bg-gray-800 rounded-lg p-4 shadow cursor-pointer';
                    summaryElement.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-medium">${summary.title}</h3>
                            <span class="text-xs text-gray-500">${summary.date}</span>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">${summary.content.substring(0, 100)}...</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xs px-2 py-1 rounded ${this.getSubjectColorClass(summary.subject)}">
                                ${summary.subject}
                            </span>
                            <button class="text-primary-600 text-xs hover:underline">Ver completo</button>
                        </div>
                    `;

                    summaryElement.addEventListener('click', () => {
                        this.showFullSummary(summary);
                    });

                    container.appendChild(summaryElement);
                });
            },

            showFullSummary(summary) {
                alert(`${summary.title}\n\nMatéria: ${summary.subject}\nData: ${summary.date}\n\n${summary.content}`);
            },

            getSubjectColorClass(subject) {
                const colorMap = {
                    'Matemática': 'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200',
                    'História': 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200',
                    'Química': 'bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200',
                    'Física': 'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200',
                    'Biologia': 'bg-indigo-100 dark:bg-indigo-900 text-indigo-800 dark:text-indigo-200',
                    'Português': 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200',
                    'Inglês': 'bg-pink-100 dark:bg-pink-900 text-pink-800 dark:text-pink-200',
                    'Geografia': 'bg-teal-100 dark:bg-teal-900 text-teal-800 dark:text-teal-200'
                };

                return colorMap[subject] || 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200';
            },

            bindEvents() {
                document.getElementById('add-summary-btn').addEventListener('click', () => {
                    this.openSummaryModal();
                });

                document.getElementById('close-summary-modal').addEventListener('click', () => {
                    this.closeSummaryModal();
                });

                document.getElementById('cancel-summary-btn').addEventListener('click', () => {
                    this.closeSummaryModal();
                });

                document.getElementById('save-summary-btn').addEventListener('click', () => {
                    this.saveSummary();
                });
            },

            openSummaryModal() {
                const modal = document.getElementById('add-summary-modal');
                modal.classList.remove('hidden');

                // Limpar campos
                document.getElementById('summary-title').value = '';
                document.getElementById('summary-content').value = '';

                // Atualizar dropdown de matérias
                NotesManager.updateSubjectDropdown();
            },

            closeSummaryModal() {
                document.getElementById('add-summary-modal').classList.add('hidden');
            },

            saveSummary() {
                const title = document.getElementById('summary-title').value.trim();
                const subject = document.getElementById('summary-subject').value;
                const content = document.getElementById('summary-content').value.trim();

                if (!title || !subject || !content) {
                    alert('Por favor, preencha todos os campos obrigatórios.');
                    return;
                }

                const currentDate = new Date();
                const formattedDate = `${currentDate.getDate()} ${this.getMonthName(currentDate.getMonth())}`;

                const newSummary = {
                    id: Date.now(),
                    title,
                    subject,
                    content,
                    date: formattedDate
                };

                AppState.summaries.unshift(newSummary);
                this.renderSummaries();
                this.closeSummaryModal();
            },

            getMonthName(monthIndex) {
                const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                return months[monthIndex];
            }
        };

        // Reminders Management
        const RemindersManager = {
            init() {
                this.renderReminders();
                this.bindEvents();

                // Adicione estes listeners para o modal de edição
                document.getElementById('close-reminder-actions-modal').addEventListener('click', () => {
                    this.closeEditModal();
                });

                document.getElementById('cancel-edit-reminder').addEventListener('click', () => {
                    this.closeEditModal();
                });

                document.getElementById('save-edit-reminder').addEventListener('click', () => {
                    this.saveEditedReminder();
                });
            },

            renderReminders() {
                const overdueReminders = document.getElementById('overdue-reminders');
                const todayReminders = document.getElementById('today-reminders');
                const upcomingReminders = document.getElementById('upcoming-reminders');
                const completedReminders = document.getElementById('completed-reminders');

                if (!overdueReminders || !todayReminders || !upcomingReminders || !completedReminders) return;

                // Limpar todos os containers
                overdueReminders.innerHTML = '';
                todayReminders.innerHTML = '';
                upcomingReminders.innerHTML = '';
                completedReminders.innerHTML = '';

                const today = new Date();
                const todayStr = today.toISOString().split('T')[0];

                // Separar lembretes concluídos e não concluídos
                const completed = AppState.reminders.filter(r => r.completed);
                const pending = AppState.reminders.filter(r => !r.completed);

                // Renderizar lembretes pendentes
                pending.forEach(reminder => {
                    const reminderElement = this.createReminderElement(reminder, today, todayStr);

                    const isOverdue = new Date(reminder.date) < today && reminder.date !== todayStr;

                    if (isOverdue) {
                        overdueReminders.appendChild(reminderElement);
                    } else if (reminder.date === todayStr) {
                        todayReminders.appendChild(reminderElement);
                    } else {
                        upcomingReminders.appendChild(reminderElement);
                    }
                });

                // Renderizar lembretes concluídos
                completed.forEach(reminder => {
                    const reminderElement = this.createReminderElement(reminder, today, todayStr, true);
                    completedReminders.appendChild(reminderElement);
                });

                // Mensagens quando não há lembretes
                if (overdueReminders.children.length === 0) {
                    overdueReminders.innerHTML = '<p class="text-center text-gray-500 py-4">Nenhum lembrete atrasado</p>';
                }

                if (todayReminders.children.length === 0) {
                    todayReminders.innerHTML = '<p class="text-center text-gray-500 py-4">Nenhum lembrete para hoje</p>';
                }

                if (upcomingReminders.children.length === 0) {
                    upcomingReminders.innerHTML = '<p class="text-center text-gray-500 py-4">Nenhum lembrete futuro</p>';
                }

                if (completedReminders.children.length === 0) {
                    completedReminders.innerHTML = '<p class="text-center text-gray-500 py-4">Nenhum lembrete concluído</p>';
                }
            },

            // Nova função auxiliar para criar elementos de lembrete
            createReminderElement(reminder, today, todayStr, isCompleted = false) {
                const reminderElement = document.createElement('div');
                let priorityClass = '';
                let iconClass = '';

                // Estilo para itens concluídos
                if (isCompleted) {
                    priorityClass = 'border-l-4 border-gray-500';
                    iconClass = 'fas fa-check-circle text-gray-500';
                    reminderElement.className = `reminder-item flex items-center p-3 rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-900/20 border border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-900/30 ${priorityClass}`;
                }
                // Estilo para itens atrasados
                else if (!reminder.completed && new Date(reminder.date) < today && reminder.date !== todayStr) {
                    priorityClass = 'border-l-4 border-red-500';
                    iconClass = 'fas fa-exclamation-circle text-red-500';
                    reminderElement.className = `reminder-item flex items-center p-3 rounded-lg cursor-pointer bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 hover:bg-red-100 dark:hover:bg-red-900/30 ${priorityClass}`;
                }
                // Estilo padrão baseado na prioridade
                else {
                    switch (reminder.priority) {
                        case 'alta':
                            priorityClass = 'border-l-4 border-red-500';
                            iconClass = 'fas fa-exclamation-circle text-red-500';
                            break;
                        case 'media':
                            priorityClass = 'border-l-4 border-yellow-500';
                            iconClass = 'fas fa-exclamation-triangle text-yellow-500';
                            break;
                        default:
                            priorityClass = 'border-l-4 border-green-500';
                            iconClass = 'fas fa-info-circle text-green-500';
                    }
                    reminderElement.className = `reminder-item flex items-center p-3 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 ${priorityClass}`;
                }

                if (!isCompleted) {
                    reminderElement.innerHTML = `
                        <!-- ... (seu HTML existente) -->
                        <div class="flex items-center space-x-2">
                            <button class="edit-reminder-btn p-1 text-gray-400 hover:text-primary-500">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn p-1 rounded" data-reminder-id="${reminder.id}">
                                <i class="far fa-check-circle text-gray-400 hover:text-green-500"></i>
                            </button>
                        </div>
                    `;
                }

                // Conteúdo do lembrete
                reminderElement.innerHTML = `
                    <i class="${iconClass} mr-3"></i>
                    <div class="flex-1">
                        <h4 class="font-medium ${isCompleted ? 'line-through text-gray-400 dark:text-gray-500' : ''}">${reminder.title}</h4>
                        <p class="text-sm ${isCompleted ? 'text-gray-400 dark:text-gray-500 line-through' : (new Date(reminder.date) < today && !isCompleted && reminder.date !== todayStr ? 'text-red-500 dark:text-red-300' : 'text-gray-500')}">
                            ${this.formatReminderDate(reminder.date)} às ${reminder.time}
                            ${(!isCompleted && new Date(reminder.date) < today && reminder.date !== todayStr) ? '<span class="text-xs bg-red-100 dark:bg-red-800 text-red-800 dark:text-red-200 px-2 py-1 rounded ml-2">Atrasado</span>' : ''}
                            ${isCompleted ? '<span class="text-xs bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200 px-2 py-1 rounded ml-2">Concluído</span>' : ''}
                        </p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="edit-reminder-btn p-1 text-gray-400 hover:text-primary-500">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn p-1 rounded" data-reminder-id="${reminder.id}">
                            <i class="${isCompleted ? 'fas fa-trash text-red-400 hover:text-red-600' : 'far fa-check-circle text-gray-400 hover:text-green-500'}"></i>
                        </button>
                    </div>
                `;

                // Adicione o event listener para o botão de edição
                reminderElement.querySelector('.edit-reminder-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.openEditModal(reminder.id);
                });

                // Evento do botão de ação
                const actionBtn = reminderElement.querySelector('.action-btn');
                if (actionBtn) {
                    actionBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (reminder.completed) {
                            this.deleteReminder(reminder.id);
                        } else {
                            this.completeReminder(reminder.id);
                        }
                    });
                }

                reminderElement.querySelector('.edit-reminder-btn')?.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.openEditModal(reminder.id);
                });

                return reminderElement;
            },

            openEditModal(reminderId) {
                const reminder = AppState.reminders.find(r => r.id === reminderId);
                if (!reminder) return;

                const modal = document.getElementById('reminder-actions-modal');
                modal.classList.remove('hidden');

                // Preenche os campos com os dados atuais
                document.getElementById('edit-reminder-title').value = reminder.title;
                document.getElementById('edit-reminder-date').value = reminder.date;
                document.getElementById('edit-reminder-time').value = reminder.time;
                document.getElementById('edit-reminder-priority').value = reminder.priority;

                // Armazena o ID do lembrete sendo editado
                modal.dataset.reminderId = reminderId;
            },

            saveEditedReminder() {
                const modal = document.getElementById('reminder-actions-modal');
                const reminderId = parseInt(modal.dataset.reminderId);

                const title = document.getElementById('edit-reminder-title').value.trim();
                const date = document.getElementById('edit-reminder-date').value;
                const time = document.getElementById('edit-reminder-time').value;
                const priority = document.getElementById('edit-reminder-priority').value;

                if (!title || !date || !time) {
                    alert("Por favor, preencha todos os campos obrigatórios.");
                    return;
                }

                const reminderIndex = AppState.reminders.findIndex(r => r.id === reminderId);
                if (reminderIndex !== -1) {
                    AppState.reminders[reminderIndex] = {
                        ...AppState.reminders[reminderIndex],
                        title,
                        date,
                        time,
                        priority
                    };

                    saveAppState().then(() => {
                        this.renderReminders();
                        DashboardManager.updateTaskProgress();
                        this.closeEditModal();
                    });
                }
            },

            closeEditModal() {
                document.getElementById('reminder-actions-modal').classList.add('hidden');
            },

            // Adicione esta função auxiliar
            formatReminderDate(dateStr) {
                const [year, month, day] = dateStr.split('-');
                const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                return `${parseInt(day)} ${months[parseInt(month) - 1]}`;
            },

            bindEvents() {
                document.getElementById('add-reminder-btn').addEventListener('click', () => {
                    this.openReminderModal();
                });

                document.getElementById('close-reminder-modal').addEventListener('click', () => {
                    this.closeReminderModal();
                });

                document.getElementById('cancel-reminder-btn').addEventListener('click', () => {
                    this.closeReminderModal();
                });

                document.getElementById('save-reminder-btn').addEventListener('click', () => {
                    this.saveReminder();
                });

                // Atualiza lembretes na tela
                RemindersManager.renderReminders();
                RemindersManager.renderTodayReminders?.();
                RemindersManager.renderUpcomingReminders?.();

                // Fecha o modal
                document.getElementById('add-reminder-modal').classList.add('hidden');

                // Volta para a aba de lembretes
                const sections = document.querySelectorAll('main > section');
                TabManager.switchToSection('reminders', sections);

                // Se você **não tem** um botão específico no rodapé para "Lembretes", use:
                TabManager.updateActiveTab('notes', document.querySelectorAll('.tab-btn'));

                // Se **tiver** um botão com data-tab="reminders", use:
                TabManager.updateActiveTab('reminders', document.querySelectorAll('.tab-btn'));

            },

            openReminderModal() {
                const modal = document.getElementById('add-reminder-modal');
                modal.classList.remove('hidden');

                // Definir a data padrão como hoje
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('reminder-date').value = today;
                document.getElementById('reminder-time').value = '12:00';
                document.getElementById('reminder-title').value = '';
                document.getElementById('reminder-priority').value = 'media';
            },

            closeReminderModal() {
                document.getElementById('add-reminder-modal').classList.add('hidden');
            },

            saveReminder() {
                console.log('Salvando lembrete...');
                const title = document.getElementById('reminder-title').value.trim();
                const date = document.getElementById('reminder-date').value;
                const time = document.getElementById('reminder-time').value;
                const priority = document.getElementById('reminder-priority').value;

                if (!title || !date || !time) {
                    alert('Por favor, preencha todos os campos obrigatórios.');
                    return;
                }

                const newReminder = {
                    id: Date.now(),
                    title,
                    date,
                    time,
                    priority,
                    completed: false
                };

                AppState.reminders.unshift(newReminder);
                saveAppState().then(() => {
                    this.renderReminders();
                    DashboardManager.updateTaskProgress();
                    this.closeReminderModal();

                    // Mostrar a aba de lembretes após salvar
                    const sections = document.querySelectorAll('main > section');
                    const tabButtons = document.querySelectorAll('.tab-btn');
                    TabManager.switchTab('reminders', null, tabButtons, sections);
                });
            },

            completeReminder(reminderId) {
                const reminder = AppState.reminders.find(r => r.id === reminderId);
                if (reminder) {
                    reminder.completed = true;
                    saveAppState().then(() => {
                        this.renderReminders();
                        DashboardManager.updateTaskProgress();
                    });
                }
            },

            deleteReminder(reminderId) {
                if (confirm('Excluir este lembrete permanentemente?')) {
                    AppState.reminders = AppState.reminders.filter(r => r.id !== reminderId);
                    saveAppState().then(() => {
                        this.renderReminders();
                        DashboardManager.updateTaskProgress();
                    });
                }
            },

            formatReminderDate(dateStr) {
                const [year, month, day] = dateStr.split('-');
                const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                return `${parseInt(day)} ${months[parseInt(month) - 1]}`;
            },

            getMonthName(monthIndex) {
                const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                return months[monthIndex];
            }
        };

        // Materials Management
        const MaterialsManager = {
            materialsTree: null,
            currentFolderId: 'root',
            currentPath: [{ id: 'root', name: 'Raiz' }],

            async init() {
                await this.loadMaterials();
                this.bindEvents();
            },

            async loadMaterials() {
                try {
                    const response = await fetchWithAuth('/api/materials');
                    if (!response.ok) {
                        throw new Error('Erro ao carregar materiais');
                    }
                    this.materialsTree = await response.json();
                    this.renderCurrentFolder();
                } catch (error) {
                    console.error('Erro ao carregar materiais:', error);
                    // Create a default empty tree if loading fails
                    this.materialsTree = {
                        root: {
                            id: 'root',
                            name: 'Raiz',
                            type: 'folder',
                            children: []
                        }
                    };
                    this.renderCurrentFolder();
                }
            },

            bindEvents() {
                document.getElementById('add-material-btn').addEventListener('click', () => {
                    this.openMaterialModal();
                });

                document.getElementById('add-folder-btn').addEventListener('click', () => {
                    this.openFolderModal();
                });

                document.getElementById('add-first-material-btn')?.addEventListener('click', () => {
                    this.openMaterialModal();
                });

                document.getElementById('material-filter').addEventListener('change', (e) => {
                    this.renderCurrentFolder();
                });
            },

            getCurrentFolder() {
                if (!this.materialsTree || !this.materialsTree.root) return null;
                return this.findNodeById(this.materialsTree.root, this.currentFolderId);
            },

            findNodeById(node, id) {
                if (!node) return null;
                if (node.id === id) return node;
                if (node.children) {
                    for (const child of node.children) {
                        const found = this.findNodeById(child, id);
                        if (found) return found;
                    }
                }
                return null;
            },

            renderCurrentFolder() {
                const currentFolder = this.getCurrentFolder();
                if (!currentFolder) return;

                this.renderBreadcrumb();
                this.renderFolders(currentFolder);
                this.renderMaterials(currentFolder);
            },

            renderBreadcrumb() {
                const container = document.getElementById('materials-breadcrumb');
                if (!container) return;

                container.innerHTML = '';

                this.currentPath.forEach((item, index) => {
                    const span = document.createElement('span');
                    span.className = 'breadcrumb-item cursor-pointer hover:text-primary-600';
                    span.dataset.id = item.id;
                    
                    if (index === 0) {
                        span.innerHTML = `<i class="fas fa-home"></i> ${item.name}`;
                    } else {
                        span.textContent = item.name;
                    }

                    span.addEventListener('click', () => {
                        this.navigateToFolder(item.id, index);
                    });

                    container.appendChild(span);

                    if (index < this.currentPath.length - 1) {
                        const separator = document.createElement('span');
                        separator.innerHTML = ' <i class="fas fa-chevron-right text-xs"></i> ';
                        container.appendChild(separator);
                    }
                });
            },

            renderFolders(currentFolder) {
                const container = document.getElementById('folders-container');
                const noFoldersMsg = document.getElementById('no-folders');
                if (!container) return;

                container.innerHTML = '';

                const folders = (currentFolder.children || []).filter(child => child.type === 'folder');

                if (folders.length === 0) {
                    noFoldersMsg?.classList.remove('hidden');
                } else {
                    noFoldersMsg?.classList.add('hidden');
                }

                folders.forEach(folder => {
                    const folderElement = document.createElement('div');
                    folderElement.className = 'folder-card bg-white dark:bg-gray-800 rounded-lg p-3 shadow border border-gray-200 dark:border-gray-700 flex items-center justify-between cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition';
                    folderElement.innerHTML = `
                        <div class="flex items-center space-x-2 flex-1 min-w-0">
                            <i class="fas fa-folder text-primary-500"></i>
                            <span class="text-sm font-medium truncate">${folder.name}</span>
                        </div>
                        <button class="delete-folder-btn p-1 text-gray-400 hover:text-red-500 ml-2" data-folder-id="${folder.id}">
                            <i class="fas fa-trash text-xs"></i>
                        </button>
                    `;

                    // Navigate on folder click
                    folderElement.addEventListener('click', (e) => {
                        if (!e.target.closest('.delete-folder-btn')) {
                            this.navigateIntoFolder(folder);
                        }
                    });

                    // Delete button
                    folderElement.querySelector('.delete-folder-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.deleteFolder(folder.id);
                    });

                    container.appendChild(folderElement);
                });
            },

            renderMaterials(currentFolder) {
                const container = document.getElementById('materials-container');
                const noMaterialsMsg = document.getElementById('no-materials');
                if (!container) return;

                container.innerHTML = '';

                const filterValue = document.getElementById('material-filter')?.value || 'Todos';
                let materials = (currentFolder.children || []).filter(child => child.type === 'material');

                if (filterValue !== 'Todos') {
                    materials = materials.filter(m => m.materialType === filterValue);
                }

                if (materials.length === 0) {
                    noMaterialsMsg?.classList.remove('hidden');
                } else {
                    noMaterialsMsg?.classList.add('hidden');
                }

                materials.forEach(material => {
                    const materialElement = document.createElement('div');
                    materialElement.className = 'material-card bg-white dark:bg-gray-800 rounded-lg p-4 shadow border border-gray-200 dark:border-gray-700 hover:shadow-md transition';
                    
                    // Build action buttons based on whether it's a file or link
                    let actionButtons = '';
                    if (material.isFile) {
                        // File: show view and download buttons
                        actionButtons = `
                            <a href="/api/materials/view/${material.id}" target="_blank" class="view-material-btn flex-1 py-1 px-2 bg-primary-600 hover:bg-primary-700 text-white text-xs rounded transition text-center">
                                <i class="fas fa-eye mr-1"></i> Visualizar
                            </a>
                            <a href="/api/materials/download/${material.id}" class="download-material-btn py-1 px-2 bg-green-600 hover:bg-green-700 text-white text-xs rounded transition text-center">
                                <i class="fas fa-download"></i>
                            </a>
                        `;
                    } else {
                        // Link: show view button (opens URL)
                        actionButtons = `
                            <a href="${material.url}" target="_blank" class="view-material-btn flex-1 py-1 px-2 bg-primary-600 hover:bg-primary-700 text-white text-xs rounded transition text-center">
                                <i class="fas fa-external-link-alt mr-1"></i> Visualizar
                            </a>
                        `;
                    }

                    // Show file indicator if it's a file
                    const fileIndicator = material.isFile ? 
                        `<span class="inline-block px-2 py-0.5 bg-indigo-100 dark:bg-indigo-900 text-indigo-800 dark:text-indigo-200 text-xs rounded mb-2 ml-1">
                            <i class="fas fa-file mr-1"></i>${material.fileName ? this.formatFileSize(material.fileSize) : 'Arquivo'}
                        </span>` : '';
                    
                    materialElement.innerHTML = `
                        <div class="flex flex-wrap gap-1 mb-2">
                            <span class="inline-block px-2 py-1 ${this.getTypeColorClass(material.materialType)} text-xs rounded">
                                ${material.materialType}
                            </span>
                            ${fileIndicator}
                        </div>
                        <h3 class="font-medium text-gray-800 dark:text-gray-200 mb-1">${material.name}</h3>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mb-3">${material.description || 'Sem descrição'}</p>
                        <div class="flex space-x-2">
                            ${actionButtons}
                            <button class="delete-material-btn py-1 px-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 text-xs rounded transition" data-material-id="${material.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;

                    materialElement.querySelector('.delete-material-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.deleteMaterial(material.id);
                    });

                    container.appendChild(materialElement);
                });
            },

            navigateIntoFolder(folder) {
                this.currentFolderId = folder.id;
                this.currentPath.push({ id: folder.id, name: folder.name });
                this.renderCurrentFolder();
            },

            navigateToFolder(folderId, pathIndex) {
                this.currentFolderId = folderId;
                this.currentPath = this.currentPath.slice(0, pathIndex + 1);
                this.renderCurrentFolder();
            },

            getTypeColorClass(type) {
                const colorMap = {
                    'PDF': 'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200',
                    'Vídeo': 'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200',
                    'Link': 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200',
                    'Documento': 'bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200',
                    'Imagem': 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200'
                };

                return colorMap[type] || 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200';
            },

            async openMaterialModal() {
                // Get available folders for the dropdown
                const folders = this.getAllFolders(this.materialsTree.root);
                const folderOptions = folders.map(f => `<option value="${f.id}"${f.id === this.currentFolderId ? ' selected' : ''}>${f.path}</option>`).join('');

                const modal = document.createElement('div');
                modal.id = 'material-modal';
                modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50';
                modal.innerHTML = `
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
                        <div class="flex justify-between items-center py-3 px-4 border-b dark:border-gray-700">
                            <h3 class="font-bold text-gray-800 dark:text-white">Adicionar Material</h3>
                            <button class="close-material-modal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="p-4">
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2 dark:text-white">Título</label>
                                <input type="text" id="material-title" class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400" placeholder="Título do material">
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2 dark:text-white">Tipo</label>
                                <select id="material-type" class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400">
                                    <option value="PDF">PDF</option>
                                    <option value="Vídeo">Vídeo</option>
                                    <option value="Link">Link</option>
                                    <option value="Documento">Documento</option>
                                    <option value="Imagem">Imagem</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2 dark:text-white">Pasta</label>
                                <select id="material-folder" class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400">
                                    ${folderOptions}
                                </select>
                            </div>
                            
                            <!-- Source toggle: Link or File -->
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2 dark:text-white">Origem</label>
                                <div class="flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1">
                                    <button type="button" id="source-link-btn" class="flex-1 py-2 px-3 text-sm font-medium rounded-md bg-white dark:bg-gray-600 shadow-sm text-primary-600 dark:text-primary-400">
                                        <i class="fas fa-link mr-1"></i> Link
                                    </button>
                                    <button type="button" id="source-file-btn" class="flex-1 py-2 px-3 text-sm font-medium rounded-md text-gray-500 dark:text-gray-400">
                                        <i class="fas fa-file-upload mr-1"></i> Arquivo
                                    </button>
                                </div>
                            </div>

                            <!-- Link input section -->
                            <div id="link-section" class="mb-4">
                                <label class="block text-sm font-medium mb-2 dark:text-white">URL/Link</label>
                                <input type="text" id="material-url" class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400" placeholder="https://...">
                            </div>

                            <!-- File upload section (hidden by default) -->
                            <div id="file-section" class="mb-4 hidden">
                                <label class="block text-sm font-medium mb-2 dark:text-white">Arquivo</label>
                                <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center cursor-pointer hover:border-primary-500 transition" id="file-drop-zone">
                                    <input type="file" id="material-file" class="hidden" accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.txt,.jpg,.jpeg,.png,.gif,.mp4,.mp3">
                                    <div id="file-upload-placeholder">
                                        <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">Clique para selecionar ou arraste o arquivo</p>
                                        <p class="text-xs text-gray-400 mt-1">PDF, DOC, DOCX, PPT, PPTX, XLS, XLSX, TXT, JPG, PNG, GIF, MP4, MP3 (Max: 50MB)</p>
                                    </div>
                                    <div id="file-preview" class="hidden">
                                        <div class="flex items-center justify-center space-x-2">
                                            <i class="fas fa-file text-2xl text-primary-500"></i>
                                            <div class="text-left">
                                                <p id="file-name" class="text-sm font-medium text-gray-800 dark:text-gray-200"></p>
                                                <p id="file-size" class="text-xs text-gray-500"></p>
                                            </div>
                                            <button type="button" id="remove-file-btn" class="p-1 text-red-500 hover:text-red-700">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <!-- Progress bar -->
                                <div id="upload-progress" class="hidden mt-2">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div id="progress-bar" class="bg-primary-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                    </div>
                                    <p id="progress-text" class="text-xs text-gray-500 mt-1 text-center">Enviando...</p>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2 dark:text-white">Descrição</label>
                                <textarea id="material-description" class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400" rows="3" placeholder="Descrição do material"></textarea>
                            </div>
                        </div>
                        <div class="flex justify-end items-center gap-x-2 py-3 px-4 border-t dark:border-gray-700">
                            <button class="cancel-material-btn py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:bg-gray-700">
                                Cancelar
                            </button>
                            <button class="save-material-btn py-2 px-3 inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-primary-600 text-white hover:bg-primary-700 disabled:opacity-50 disabled:pointer-events-none">
                                Salvar Material
                            </button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // State for the modal
                let isFileMode = false;
                let selectedFile = null;

                const sourceLinkBtn = modal.querySelector('#source-link-btn');
                const sourceFileBtn = modal.querySelector('#source-file-btn');
                const linkSection = modal.querySelector('#link-section');
                const fileSection = modal.querySelector('#file-section');
                const fileInput = modal.querySelector('#material-file');
                const fileDropZone = modal.querySelector('#file-drop-zone');
                const fileUploadPlaceholder = modal.querySelector('#file-upload-placeholder');
                const filePreview = modal.querySelector('#file-preview');
                const fileNameEl = modal.querySelector('#file-name');
                const fileSizeEl = modal.querySelector('#file-size');
                const removeFileBtn = modal.querySelector('#remove-file-btn');

                // Toggle between link and file modes
                sourceLinkBtn.addEventListener('click', () => {
                    isFileMode = false;
                    sourceLinkBtn.classList.add('bg-white', 'dark:bg-gray-600', 'shadow-sm', 'text-primary-600', 'dark:text-primary-400');
                    sourceLinkBtn.classList.remove('text-gray-500', 'dark:text-gray-400');
                    sourceFileBtn.classList.remove('bg-white', 'dark:bg-gray-600', 'shadow-sm', 'text-primary-600', 'dark:text-primary-400');
                    sourceFileBtn.classList.add('text-gray-500', 'dark:text-gray-400');
                    linkSection.classList.remove('hidden');
                    fileSection.classList.add('hidden');
                });

                sourceFileBtn.addEventListener('click', () => {
                    isFileMode = true;
                    sourceFileBtn.classList.add('bg-white', 'dark:bg-gray-600', 'shadow-sm', 'text-primary-600', 'dark:text-primary-400');
                    sourceFileBtn.classList.remove('text-gray-500', 'dark:text-gray-400');
                    sourceLinkBtn.classList.remove('bg-white', 'dark:bg-gray-600', 'shadow-sm', 'text-primary-600', 'dark:text-primary-400');
                    sourceLinkBtn.classList.add('text-gray-500', 'dark:text-gray-400');
                    fileSection.classList.remove('hidden');
                    linkSection.classList.add('hidden');
                });

                // File drop zone click
                fileDropZone.addEventListener('click', () => {
                    if (!selectedFile) {
                        fileInput.click();
                    }
                });

                // File selection
                fileInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        this.handleFileSelection(file, modal);
                        selectedFile = file;
                    }
                });

                // Drag and drop
                fileDropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    fileDropZone.classList.add('border-primary-500', 'bg-primary-50', 'dark:bg-primary-900/20');
                });

                fileDropZone.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    fileDropZone.classList.remove('border-primary-500', 'bg-primary-50', 'dark:bg-primary-900/20');
                });

                fileDropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    fileDropZone.classList.remove('border-primary-500', 'bg-primary-50', 'dark:bg-primary-900/20');
                    const file = e.dataTransfer.files[0];
                    if (file) {
                        this.handleFileSelection(file, modal);
                        selectedFile = file;
                    }
                });

                // Remove file
                removeFileBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    selectedFile = null;
                    fileInput.value = '';
                    fileUploadPlaceholder.classList.remove('hidden');
                    filePreview.classList.add('hidden');
                });

                modal.querySelector('.close-material-modal').addEventListener('click', () => modal.remove());
                modal.querySelector('.cancel-material-btn').addEventListener('click', () => modal.remove());
                modal.querySelector('.save-material-btn').addEventListener('click', () => this.saveMaterial(modal, isFileMode, selectedFile));
            },

            handleFileSelection(file, modal) {
                const maxSize = 50 * 1024 * 1024; // 50MB
                const allowedTypes = ['.pdf', '.doc', '.docx', '.ppt', '.pptx', '.xls', '.xlsx', '.txt', '.jpg', '.jpeg', '.png', '.gif', '.mp4', '.mp3'];
                const ext = '.' + file.name.split('.').pop().toLowerCase();

                if (!allowedTypes.includes(ext)) {
                    alert('Tipo de arquivo não permitido. Tipos permitidos: ' + allowedTypes.join(', '));
                    return false;
                }

                if (file.size > maxSize) {
                    alert('Arquivo muito grande. Tamanho máximo: 50MB');
                    return false;
                }

                const fileUploadPlaceholder = modal.querySelector('#file-upload-placeholder');
                const filePreview = modal.querySelector('#file-preview');
                const fileNameEl = modal.querySelector('#file-name');
                const fileSizeEl = modal.querySelector('#file-size');

                fileUploadPlaceholder.classList.add('hidden');
                filePreview.classList.remove('hidden');
                fileNameEl.textContent = file.name;
                fileSizeEl.textContent = this.formatFileSize(file.size);

                return true;
            },

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            },

            getAllFolders(node, path = '') {
                const folders = [];
                const currentPath = path ? `${path} / ${node.name}` : node.name;
                folders.push({ id: node.id, name: node.name, path: currentPath });
                
                if (node.children) {
                    for (const child of node.children) {
                        if (child.type === 'folder') {
                            folders.push(...this.getAllFolders(child, currentPath));
                        }
                    }
                }
                return folders;
            },

            openFolderModal() {
                const modal = document.createElement('div');
                modal.id = 'folder-modal';
                modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50';
                modal.innerHTML = `
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-sm w-full mx-4">
                        <div class="flex justify-between items-center py-3 px-4 border-b dark:border-gray-700">
                            <h3 class="font-bold text-gray-800 dark:text-white">Nova Pasta</h3>
                            <button class="close-folder-modal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="p-4">
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2 dark:text-white">Nome da Pasta</label>
                                <input type="text" id="folder-name" class="py-2 px-3 block w-full border border-gray-200 rounded-lg text-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400" placeholder="Nome da pasta">
                            </div>
                        </div>
                        <div class="flex justify-end items-center gap-x-2 py-3 px-4 border-t dark:border-gray-700">
                            <button class="cancel-folder-btn py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:bg-gray-700">
                                Cancelar
                            </button>
                            <button class="save-folder-btn py-2 px-3 inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-primary-600 text-white hover:bg-primary-700">
                                Criar Pasta
                            </button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                modal.querySelector('.close-folder-modal').addEventListener('click', () => modal.remove());
                modal.querySelector('.cancel-folder-btn').addEventListener('click', () => modal.remove());
                modal.querySelector('.save-folder-btn').addEventListener('click', () => this.saveFolder(modal));
            },

            async saveFolder(modal) {
                const name = document.getElementById('folder-name').value.trim();

                if (!name) {
                    alert('Por favor, insira um nome para a pasta.');
                    return;
                }

                try {
                    const response = await fetchWithAuth('/api/materials/folder', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            name: name,
                            parentId: this.currentFolderId
                        })
                    });

                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error || 'Erro ao criar pasta');
                    }

                    modal.remove();
                    await this.loadMaterials();
                } catch (error) {
                    alert(error.message);
                }
            },

            async saveMaterial(modal, isFileMode = false, selectedFile = null) {
                const title = document.getElementById('material-title').value.trim();
                const type = document.getElementById('material-type').value;
                const folderId = document.getElementById('material-folder').value;
                const url = document.getElementById('material-url').value.trim();
                const description = document.getElementById('material-description').value.trim();

                if (!title) {
                    alert('Por favor, preencha o título do material.');
                    return;
                }

                if (!isFileMode && !url) {
                    alert('Por favor, preencha a URL do material.');
                    return;
                }

                if (isFileMode && !selectedFile) {
                    alert('Por favor, selecione um arquivo.');
                    return;
                }

                try {
                    let materialData = {
                        name: title,
                        parentId: folderId,
                        materialType: type,
                        description: description,
                        isFile: isFileMode
                    };

                    if (isFileMode && selectedFile) {
                        // Show progress
                        const progressDiv = modal.querySelector('#upload-progress');
                        const progressBar = modal.querySelector('#progress-bar');
                        const progressText = modal.querySelector('#progress-text');
                        progressDiv.classList.remove('hidden');

                        // Upload file first
                        const formData = new FormData();
                        formData.append('file', selectedFile);

                        const token = localStorage.getItem('jwtToken');
                        const xhr = new XMLHttpRequest();
                        
                        const uploadResult = await new Promise((resolve, reject) => {
                            xhr.upload.addEventListener('progress', (e) => {
                                if (e.lengthComputable) {
                                    const percent = Math.round((e.loaded / e.total) * 100);
                                    progressBar.style.width = percent + '%';
                                    progressText.textContent = `Enviando... ${percent}%`;
                                }
                            });

                            xhr.addEventListener('load', () => {
                                if (xhr.status >= 200 && xhr.status < 300) {
                                    resolve(JSON.parse(xhr.responseText));
                                } else {
                                    try {
                                        const error = JSON.parse(xhr.responseText);
                                        reject(new Error(error.error || 'Erro ao fazer upload'));
                                    } catch {
                                        reject(new Error('Erro ao fazer upload do arquivo'));
                                    }
                                }
                            });

                            xhr.addEventListener('error', () => {
                                reject(new Error('Erro de rede ao fazer upload'));
                            });

                            xhr.open('POST', '/api/materials/upload');
                            xhr.setRequestHeader('Authorization', 'Bearer ' + token);
                            xhr.send(formData);
                        });

                        progressText.textContent = 'Salvando material...';
                        progressBar.style.width = '100%';

                        // Add file info to material data
                        materialData.filePath = uploadResult.filePath;
                        materialData.fileName = uploadResult.fileName;
                        materialData.fileSize = uploadResult.fileSize;
                        materialData.url = ''; // No URL for files
                    } else {
                        materialData.url = url;
                    }

                    const response = await fetchWithAuth('/api/materials/material', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(materialData)
                    });

                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error || 'Erro ao criar material');
                    }

                    modal.remove();
                    await this.loadMaterials();
                } catch (error) {
                    alert(error.message);
                }
            },

            async deleteMaterial(materialId) {
                if (!confirm('Tem certeza que deseja excluir este material?')) return;

                try {
                    const response = await fetchWithAuth(`/api/materials/${materialId}`, {
                        method: 'DELETE'
                    });

                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error || 'Erro ao excluir material');
                    }

                    await this.loadMaterials();
                } catch (error) {
                    alert(error.message);
                }
            },

            async deleteFolder(folderId) {
                if (!confirm('Tem certeza que deseja excluir esta pasta e todo seu conteúdo?')) return;

                try {
                    const response = await fetchWithAuth(`/api/materials/${folderId}`, {
                        method: 'DELETE'
                    });

                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error || 'Erro ao excluir pasta');
                    }

                    await this.loadMaterials();
                } catch (error) {
                    alert(error.message);
                }
            }
        };
        // Notifications Management
        const NotificationsManager = {
            init() {
                this.renderNotifications();
                this.bindEvents();
            },

            bindEvents() {
                document.getElementById('notifications-btn').addEventListener('click', (e) => {
                    e.stopPropagation(); // Impede a propagação do evento
                    this.toggleNotificationsPanel();
                });

                // ... outros event listeners
            },

            toggleNotificationsPanel() {
                const panel = document.getElementById('notifications-panel');
                panel.classList.toggle('translate-x-full');

                // Não muda a aba ativa, apenas mostra/oculta o painel
                TabManager.switchToSection(currentActiveTab, document.querySelectorAll('main > section'));
            },

            // ... mantenha as outras funções

            renderNotifications() {
                const container = document.getElementById('notifications-container');
                if (!container) return;

                container.innerHTML = '';

                const today = new Date().toISOString().split('T')[0];
                const todayEvents = AppState.events.filter(event => event.date === today);

                if (todayEvents.length > 0) {
                    todayEvents.forEach(event => {
                        const notificationElement = document.createElement('div');
                        notificationElement.className = 'flex items-start p-3 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700';

                        notificationElement.innerHTML = `
                            <div class="p-2 bg-primary-500 rounded-full mr-3">
                                <i class="fas fa-calendar text-white text-xs"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-medium text-primary-600">${event.title}</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-300">${event.time} - ${event.description || 'Sem descrição'}</p>
                            </div>
                            <button class="delete-notification-btn p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded" data-event-id="${event.id}">
                                <i class="fas fa-times text-gray-400 hover:text-red-500"></i>
                            </button>
                        `;

                        container.appendChild(notificationElement);
                    });
                } else {
                    container.innerHTML = '<p class="text-center text-gray-500 py-4">Nenhuma notificação hoje</p>';
                }

                // Atualizar badge
                const badge = document.getElementById('notification-badge');
                if (badge) {
                    badge.textContent = todayEvents.length;
                    badge.classList.toggle('hidden', todayEvents.length === 0);
                }
            },

            bindEvents() {
                document.getElementById('notifications-btn').addEventListener('click', () => {
                    this.toggleNotificationsPanel();
                });

                document.getElementById('close-notifications').addEventListener('click', () => {
                    this.closeNotificationsPanel();
                });

                // Deletar notificação/evento
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.delete-notification-btn')) {
                        const eventId = parseInt(e.target.closest('.delete-notification-btn').dataset.eventId);
                        this.deleteEvent(eventId);
                    }
                });
            },

            deleteEvent(eventId) {
                if (!confirm('Deseja excluir este evento permanentemente?')) {
                    return;
                }

                const loadingIndicator = document.createElement('div');
                loadingIndicator.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                loadingIndicator.innerHTML = '<div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg">Deletando evento...</div>';
                document.body.appendChild(loadingIndicator);

                fetchWithAuth(`/api/events/${eventId}`, {
                    method: 'DELETE'
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(() => {
                        // Atualiza o estado local
                        AppState.events = AppState.events.filter(event => event.id !== eventId);

                        // Atualiza as views
                        this.renderNotifications();
                        CalendarManager.renderCalendar();
                        CalendarManager.renderUpcomingEvents();

                        // Fecha qualquer modal aberto
                        document.querySelectorAll('.fixed.inset-0').forEach(el => el.remove());
                    })
                    .catch(error => {
                        console.error('Error deleting event:', error);
                        alert('Falha ao deletar evento: ' + error.message);
                    })
                    .finally(() => {
                        loadingIndicator.remove();
                    });
            },

            toggleNotificationsPanel() {
                const panel = document.getElementById('notifications-panel');
                panel.classList.toggle('translate-x-full');
            },

            closeNotificationsPanel() {
                const panel = document.getElementById('notifications-panel');
                panel.classList.add('translate-x-full');

                // Restaura a aba que estava ativa antes
                TabManager.switchToSection(currentActiveTab, document.querySelectorAll('main > section'));
            }
        };

        // Config Manager
        const ConfigManager = {
            init() {
                this.loadConfig();
                this.bindEvents();
            },

            loadConfig() {
                // Carrega configurações do localStorage ou usa padrões
                const savedConfig = localStorage.getItem('studyBuddyConfig');

                if (savedConfig) {
                    AppState.config = JSON.parse(savedConfig);
                } else {
                    // Configurações padrão
                    AppState.config = {
                        username: 'Estudante',
                        email: '',
                        darkMode: true,
                        notifications: true,
                        spotifyPlaylist: '6zCID88oNjNv9zx6puDHKj',
                        youtubePlaylist: 'OLAK5uy_n7j7fvy5z8rCPguuoV_Cv8dRuRFMQuTbM'
                    };
                }

                // Preenche os campos do formulário
                document.getElementById('username').value = AppState.config.username;
                document.getElementById('email').value = AppState.config.email;
                document.getElementById('dark-mode-toggle').checked = AppState.config.darkMode;
                document.getElementById('notifications-toggle').checked = AppState.config.notifications;
                document.getElementById('spotify-playlist').value = AppState.config.spotifyPlaylist;
                document.getElementById('youtube-playlist').value = AppState.config.youtubePlaylist;

                // Aplica o tema
                if (AppState.config.darkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            },

            saveConfig() {
                localStorage.setItem('studyBuddyConfig', JSON.stringify(AppState.config));
            },

            bindEvents() {
                // Salvar configurações da conta
                document.getElementById('save-account-btn').addEventListener('click', () => {
                    const username = document.getElementById('username').value.trim();
                    const email = document.getElementById('email').value.trim();
                    const newPassword = document.getElementById('new-password').value;
                    const confirmPassword = document.getElementById('confirm-password').value;

                    if (!username) {
                        alert('Por favor, insira um nome de usuário válido.');
                        return;
                    }

                    if (newPassword && newPassword !== confirmPassword) {
                        alert('As senhas não coincidem.');
                        return;
                    }

                    AppState.config.username = username;
                    AppState.config.email = email;

                    if (newPassword) {
                        // Aqui você faria a atualização da senha no backend
                        console.log('Senha alterada para:', newPassword);
                    }

                    this.saveConfig();
                    alert('Configurações da conta salvas com sucesso!');
                });

                // Alternar tema escuro
                document.getElementById('dark-mode-toggle').addEventListener('change', (e) => {
                    AppState.config.darkMode = e.target.checked;
                    this.saveConfig();

                    if (e.target.checked) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                });

                // Alternar notificações
                document.getElementById('notifications-toggle').addEventListener('change', (e) => {
                    AppState.config.notifications = e.target.checked;
                    this.saveConfig();

                    if (e.target.checked && Notification.permission !== 'granted') {
                        Notification.requestPermission();
                    }
                });

                // Salvar preferências musicais
                document.getElementById('save-music-btn').addEventListener('click', () => {
                    const spotifyPlaylist = document.getElementById('spotify-playlist').value.trim();
                    const youtubePlaylist = document.getElementById('youtube-playlist').value.trim();

                    // Extrai apenas o ID da playlist do Spotify se for uma URL completa
                    let spotifyId = spotifyPlaylist;
                    if (spotifyPlaylist.includes('spotify.com')) {
                        const match = spotifyPlaylist.match(/playlist\/([a-zA-Z0-9]+)/);
                        if (match) spotifyId = match[1];
                    }

                    AppState.config.spotifyPlaylist = spotifyId;
                    AppState.config.youtubePlaylist = youtubePlaylist;
                    this.saveConfig();

                    // Atualiza o player de música se estiver na aba de foco
                    if (currentActiveTab === 'focus') {
                        TimerManager.setupBackgroundMusicToggle();
                    }

                    alert('Preferências musicais atualizadas!');
                });

                // Exportar dados
                document.getElementById('export-data-btn').addEventListener('click', () => {
                    const data = {
                        notes: AppState.notes,
                        reminders: AppState.reminders,
                        studyLog: AppState.studyLog,
                        subjects: AppState.subjects,
                        events: AppState.events,
                        summaries: AppState.summaries,
                        config: AppState.config
                    };

                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `studybuddy-backup-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                });

                // Importar dados
                document.getElementById('import-data-btn').addEventListener('click', () => {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';

                    input.onchange = e => {
                        const file = e.target.files[0];
                        if (!file) return;

                        const reader = new FileReader();
                        reader.onload = event => {
                            try {
                                const data = JSON.parse(event.target.result);

                                if (confirm('Isso substituirá todos os seus dados atuais. Continuar?')) {
                                    AppState.notes = data.notes || [];
                                    AppState.reminders = data.reminders || [];
                                    AppState.studyLog = data.studyLog || {};
                                    AppState.subjects = data.subjects || [];
                                    AppState.events = data.events || [];
                                    AppState.summaries = data.summaries || [];
                                    AppState.config = data.config || {
                                        username: 'Estudante',
                                        email: '',
                                        darkMode: true,
                                        notifications: true,
                                        spotifyPlaylist: '6zCID88oNjNv9zx6puDHKj',
                                        youtubePlaylist: 'OLAK5uy_n7j7fvy5z8rCPguuoV_Cv8dRuRFMQuTbM'
                                    };

                                    // Salva todos os dados
                                    saveAppState();
                                    this.saveConfig();

                                    // Recarrega as visualizações
                                    NotesManager.renderNotes();
                                    RemindersManager.renderReminders();
                                    CalendarManager.renderCalendar();
                                    CalendarManager.renderUpcomingEvents();
                                    SummariesManager.renderSummaries();
                                    DashboardManager.updateStudyTime();
                                    DashboardManager.updateTaskProgress();
                                    DashboardManager.renderStudyChart();
                                    this.loadConfig();

                                    alert('Dados importados com sucesso!');
                                }
                            } catch (error) {
                                alert('Erro ao importar dados: arquivo inválido.');
                                console.error(error);
                            }
                        };
                        reader.readAsText(file);
                    };
                    input.click();
                });

                // Redefinir dados
                document.getElementById('reset-data-btn').addEventListener('click', () => {
                    if (confirm('Tem certeza que deseja redefinir TODOS os dados? Isso não pode ser desfeito.')) {
                        AppState.notes = [];
                        AppState.reminders = [];
                        AppState.studyLog = {};
                        AppState.subjects = [];
                        AppState.events = [];
                        AppState.summaries = [];

                        saveAppState().then(() => {
                            NotesManager.renderNotes();
                            RemindersManager.renderReminders();
                            CalendarManager.renderCalendar();
                            CalendarManager.renderUpcomingEvents();
                            SummariesManager.renderSummaries();
                            DashboardManager.updateStudyTime();
                            DashboardManager.updateTaskProgress();
                            DashboardManager.renderStudyChart();

                            alert('Todos os dados foram redefinidos.');
                        });
                    }
                });

                // Excluir conta
                document.getElementById('delete-account-btn').addEventListener('click', () => {
                    if (confirm('Tem certeza que deseja excluir sua conta PERMANENTEMENTE? Todos os dados serão perdidos.')) {
                        // Aqui você faria uma chamada para o backend para excluir a conta
                        // Por enquanto, apenas limpa os dados locais
                        localStorage.clear();
                        AppState.notes = [];
                        AppState.reminders = [];
                        AppState.studyLog = {};
                        AppState.subjects = [];
                        AppState.events = [];
                        AppState.summaries = [];
                        AppState.config = {
                            username: 'Estudante',
                            email: '',
                            darkMode: true,
                            notifications: true,
                            spotifyPlaylist: '6zCID88oNjNv9zx6puDHKj',
                            youtubePlaylist: 'OLAK5uy_n7j7fvy5z8rCPguuoV_Cv8dRuRFMQuTbM'
                        };

                        // Recarrega a página para aplicar as mudanças
                        location.reload();
                    }
                });
            }
        };
        // Initialize all managers when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                window.location.href = '/login';
                return;
            }

            ConfigManager.init();
            ThemeManager.init();
            TabManager.init();
            NotesManager.init();
            TimerManager.init();
            CalendarManager.init();
            SummariesManager.init();
            RemindersManager.init();
            NotificationsManager.init();
            MaterialsManager.init();

            // Initialize task counter
            const taskCounter = document.getElementById('task-counter');
            if (taskCounter) {
                const today = new Date().toISOString().split('T')[0];
                const todayReminders = AppState.reminders.filter(r => r.date === today);
                const completed = todayReminders.filter(r => r.completed).length;
                const total = todayReminders.length;
                taskCounter.textContent = `${completed}/${total}`;
            }


            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        });
    </script>
</body>

</html>